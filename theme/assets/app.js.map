{"version":3,"sources":["app/box-app.js","app/collection.js","app/components/add-button.js","app/components/animation-wrapper.js","app/components/bar-loader.js","app/components/container-box.bak.js","app/components/container-box.first-animate.js","app/components/container-box.js","app/components/container/box-products.js","app/components/container/date-selector.js","app/components/container/product-selector.js","app/components/container/quantity-form.js","app/components/error.js","app/components/events.js","app/components/fetch.js","app/components/flash.js","app/components/icon-cart.js","app/components/price.js","app/components/product-box.bak.js","app/components/product-box.js","app/components/product-description.js","app/components/select-menu.js","app/components/text-button.js","app/helpers.js","app/initialize.js","app/lib.js","app/template.js"],"names":["init","productJson","JSON","parse","document","getElementById","textContent","type","renderer","render","querySelector","BoxContent","baseUrl","menuSelectDate","fetchError","loading","fetchJson","fetchDates","includedProducts","handleMouseUp","ev","target","tagName","id","refresh","getAttribute","date","selectedDate","addEventListener","customizeBox","url","Date","window","swup","location","loadPage","submitCart","cart","data","shopify_variant_id","quantity","properties","join","headers","src","error","json","then","Object","keys","length","map","el","shopify_handle","shopify_title","text","item","content","querySelectorAll","forEach","parentNode","AnimationWrapper","Component","props","animationOptions","duration","easing","fill","animateChildren","childs","targetHeight","style","getComputedStyle","matrix","webkitTransform","mozTransform","matrixMatch","match","Y","parseInt","split","deltaY","animation","animate","transformOrigin","transform","getChildren","nextChild","nextSibling","nodeName","push","wrapper","app","width","clientWidth","footer","animateMount","show","targetId","targetBox","getBoundingClientRect","height","setAttribute","opacity","currentActive","isActive","awaitRender","componentId","setTimeout","schedule","div","dataHeight","oldHeight","currentHeight","BarLoader","hasOwnProp","prototype","hasOwnProperty","ContainerBoxApp","idMap","variantMap","flashMessage","selectedIncludes","possibleAddons","selectedExcludes","selectedAddons","menuAddItem","menuRemoveItem","modalQtyForm","totalPrice","variants","price","loadedFromCart","boxEditHeight","toPrice","num","toFixed","getPrice","includes","shopify_price","updatePriceElement","start","selectedBox","innerHTML","moveItem","from","to","i","shopify_id","splice","loadBox","checkLoadPresence","product","found","find","replace","addOnProducts","tmpIncludedIds","tmpAddonIds","filter","selectBox","call","ts","getTime","handleChange","name","value","handleEditBoxActive","boxEdit","description","addButton","boxEditRect","console","log","keyFrames","classList","add","handleClick","editBoxActiveComplete","editBoxActive","fetchData","fetchUrl","fetchCurrentDates","loadCart","items","product_type","box","fetchBox","warn","removedItems","trim","checkPresence","variant_id","fetchCart","makeCart","total_price","makeTitle","title","product_id","shopify_product_id","handle","search","d","slice","toDateString","Paragraph","TextParagraph","cartJson","options","childanimation","getData","showBoxActive","cartBoxId","cartAddons","cartRemovedItems","ob","cartAddonIds","currentSelectedAddons","clearError","clearJson","handleDateSelect","detail","listMap","str","list","moveProduct","fromList","toList","quantityUpdate","productList","targetList","showBox","BoxProducts","dispatchEvent","DateSelector","selectDateOpen","selectorId","handleSelectorOpen","selector","ProductSelector","removeItemOpen","addItemOpen","addItemId","removeItemId","QuantityForm","titleStyle","quantityStyle","priceStyle","TitleInput","QuantityInput","PriceInput","ErrorMsg","msg","toString","err","moveProductEvent","CustomEvent","bubbles","selectDateEvent","selectorOpenEvent","quantityUpdateEvent","Fetch","fetch","response","status","Error","stringify","PostFetch","formdata","opts","method","body","Flash","children","IconCart","ProductBoxApp","cartBox","variant","fetchBoxes","inCart","addOn","included","entries","byDeliveryDate","addOnProduct","includedProduct","deliveryDate","image","product_title","delivered","ProductDescription","featured_image","SelectMenu","active","menu","startsWith","idx","arr","TextButton","index","array","position","borders","slug","sortObjectByKeys","o","sort","reduce","r","k","sortObjectByKey","key","a","b","nameA","nameB","Number","isInteger","toUpperCase","findNextWeekday","day","now","setDate","getDate","getDay","page_type","collection","boxApp","Swup","cache","plugins","SwupScrollPlugin","SwupProgressPlugin","containers","on","shallowEqual","object1","object2","keys1","keys2","Template"],"mappings":"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AKgB;AACZ;AACA,+BAAiB,eAFL;AAGZ;AACA,+BAAiB,eAJL;AAKZ;AACA,+BAAiB,eANL;AAOZ;AACA,+BAAiB,eARL;AASZ;AACA,+BAAiB,eAVL;AAWZ;AACA,+BAAiB;AAZL,aALhB;AAmBE;AACF;AACA;AACA;;AACQC,sBAvBR,GAuBqBtH,IAAI,CAACC,KAAL,CAAWC,QAAQ,CAACM,aAAT,CAAuB,cAAvB,EAAuCJ,WAAlD,CAvBrB;AAwBE;AACF;AACA;AACA;AACA;AACA;;AACMQ,sBA9BN,GA8BmB,IA9BnB;AA+BE;AACF;AACA;AACA;AACA;AACA;;AACMC,mBArCN,GAqCgB,IArChB;AAsCE;AACF;AACA;AACA;AACA;AACA;;AACM0G,wBA5CN,GA4CqB,+BA5CrB;AA6CE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AACMzG,qBArDN,GAqDkB,EArDlB;AAsDE;AACF;AACA;AACA;AACA;AACA;;AACMC,sBA5DN,GA4DmB,EA5DnB;AA6DE;AACF;AACA;AACA;AACA;AACA;;AACQL,mBAnER,GAmEkB,yCAnElB;AAoEE;AACF;AACA;AACA;AACA;AACA;;AASE;AACF;AACA;AACA;AACA;AACA;AACA;AACM8G,4BAzFN,GAyFyB,EAzFzB;AA0FE;AACF;AACA;AACA;AACA;AACA;;AACMC,0BAhGN,GAgGuB,EAhGvB;AAiGE;AACF;AACA;AACA;AACA;AACA;;AACMC,4BAvGN,GAuGyB,EAvGzB;AAwGE;AACF;AACA;AACA;AACA;AACA;;AACMC,0BA9GN,GA8GuB,EA9GvB;AA+GE;AACF;AACA;AACA;AACA;AACA;;AASE;AACF;AACA;AACA;AACA;AACA;AACMhH,0BAnIN,GAmIsB,KAnItB;AAoIE;AACF;AACA;AACA;AACA;AACA;;AACMiH,uBA1IN,GA0IoB,KA1IpB;AA2IE;AACF;AACA;AACA;AACA;AACA;;AACMC,0BAjJN,GAiJuB,KAjJvB;AAkJE;AACF;AACA;AACA;AACA;AACA;;AACMC,wBAxJN,GAwJqB,KAxJrB;AAyJE;AACF;AACA;AACA;AACA;AACA;;AAE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ACA;;AACMC,sBArCN,GAqCmB,EArCnB;AAsCE;AACF;AACA;AACA;AACA;AACA;;AASE;AACF;AACA;AACA;AACA;AACA;AACA;AACMyG,4BA3DN,GA2DyB,EA3DzB;AA4DE;AACF;AACA;AACA;AACA;AACA;;AACMC,0BAlEN,GAkEuB,EAlEvB;AAmEE;AACF;AACA;AACA;AACA;AACA;;AACMC,4BAzEN,GAyEyB,EAzEzB;AA0EE;AACF;AACA;AACA;AACA;AACA;;AACMC,0BAhFN,GAgFuB,EAhFvB;AAiFE;AACF;AACA;AACA;AACA;AACA;AACA;;AACMI,sBAxFN,GAwFmBhI,WAAW,CAACiI,QAAZ,CAAqB,CAArB,EAAwBC,KAxF3C;AAyFE;AACF;AACA;AACA;AACA;AACA;;AACMgF,yBA/FN,GA+FsB,KA/FtB;AAgGE;AACF;AACA;AACA;AACA;AACA;;AACMhC,yBAtGN,GAsGsB,KAtGtB;AAuGE;AACF;AACA;AACA;AACA;AACA;;AACMnD,wBA7GN,GA6GqB,KA7GrB;AA8GE;AACF;AACA;AACA;AACA;AACA;;AACMI,0BApHN,GAoHuB,KApHvB;AAqHE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;AACMgF,qBA7HN,GA6HkB,IA7HlB;AA8HE;AACF;AACA;AACA;AACA;AACA;;AACQC,sBApIR,GAoIqB,EApIrB;AAqIE;AACF;AACA;AACA;AACA;AACA;;AACMC,4BA3IN,GA2IyB,EA3IzB;AA4IE;AACF;AACA;AACA;AACA;AACA;AACA;;AAlJA;AAAA,wCAmJyBpN,IAAI,CAACC,KAAL,CACrBC,QAAQ,CAACM,aAAT,CAAuB,YAAvB,EAAqCJ,WADhB,CAnJzB;;AAAA;AAmJQyM,oBAnJR;;AAsJE;AACF;AACA;AACA;AACA;AACQzD,mBA3JR,GA2JkB,SAAVA,OAAU,GAAM;AACpB;AACA,kBAAMC,iBAAiB,GAAG,SAApBA,iBAAoB,CAACC,OAAD,EAAa;AACrC,oBAAMC,KAAK,GAAG/B,gBAAgB,CAACgC,IAAjB,CAAsB,UAAAtG,EAAE;AAAA,yBAAIA,EAAE,CAACb,kBAAH,K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","file":"theme/assets/app.js","sourcesContent":["/** @jsx createElement */\n/**\n * Router and starting  point of the box app.\n * Renders [crank]{@link https://www.npmjs.com/@bikeshaving/crank} elements\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/initialize\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\nimport ContainerBoxApp from \"./components/container-box\";\nimport ProductBoxApp from \"./components/product-box\";\n\nconst init = async () => {\n  const productJson = JSON.parse(document.getElementById(\"product-json\").textContent);\n  if (productJson.type === \"Container Box\") {\n    await renderer.render(<ContainerBoxApp productJson={productJson} />, document.querySelector(\"#app\"));\n  } else if (productJson.type === \"Box Produce\") {\n    await renderer.render(<ProductBoxApp productJson={productJson} />, document.querySelector(\"#app\"));\n  } else {\n    return;\n  }\n};\n\n// imported by initialize\nexport default { init };\n","/** @jsx createElement */\n/**\n * Home page client app for collection listings\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/home-page\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\n\nimport { Fetch, PostFetch } from \"./components/fetch\";\nimport Error from \"./components/error\";\nimport BarLoader from \"./components/bar-loader\";\nimport SelectMenu from \"./components/select-menu\";\n\nfunction* BoxContent ({productJson}) {\n  /**\n   * Base url to api\n   *\n   * @member baseUrl\n   * @type {string}\n   */\n  const baseUrl = \"https://streamsidedev.cousinsd.net/api/\";\n  /**\n   * The selected date after user select, one of fetchJson.keys\n   *\n   * @member selectedDate\n   * @type {string}\n   */\n  let selectedDate;\n  /**\n   * Display date selection menu if active\n   *\n   * @member menuSelectDate\n   * @type {boolean}\n   */\n  let menuSelectDate= false;\n  /**\n   * If fetching data was unsuccessful.\n   *\n   * @member fetchError\n   * @type {object|string|null}\n   */\n  let fetchError = null;\n  /**\n   * Display loading indicator while fetching data\n   *\n   * @member loading\n   * @type {boolean}\n   */\n  let loading = true;\n  /**\n   * Contains box data as collected from [api/current-boxes-by-product]{@link\n   * module:api/current-boxes-by-product}. The data uses delivery date as keys to unsorted\n   * array of box data.\n   *\n   * @member fetchJson\n   * @type {object}\n   */\n  let fetchJson = {};\n  /**\n   * Upcoming delivery dates\n   *\n   * @member fetchDates\n   * @type {object}\n   */\n  let fetchDates = [];\n  /**\n   * Included products - disregarding delivery date for now\n   *\n   * @member includedProducts\n   * @type {object}\n   */\n  let includedProducts = [];\n  /**\n   * Handle mouse up on selected components\n   *\n   * @function handleMouseUp\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleMouseUp = (ev) => {\n    if (ev.target.tagName === \"BUTTON\") {\n\n      switch(ev.target.id) {\n        case `selectDate${productJson.id}`:\n          menuSelectDate = !menuSelectDate;\n          this.refresh()\n          break;\n      }\n\n    } else if (ev.target.tagName === \"DIV\") {\n\n      switch(ev.target.getAttribute(\"name\")) {\n        case `selectDate${productJson.id}`:\n          const date = ev.target.getAttribute(\"data-item\");\n          selectedDate = date;\n\n          //selectedBox = fetchJson[selectedDate];\n          // now seriously I need to update includedProducts\n          // and also check cart\n          //selectBox(date);\n          includedProducts = fetchJson[selectedDate].includedProducts;\n          menuSelectDate = false;\n          this.refresh()\n          break;\n      }\n    }\n  };\n\n  this.addEventListener(\"mouseup\", handleMouseUp);\n\n  /**\n   * Customize box clicked - reload page to box product\n   *\n   * @function customizeBox\n   */\n  const customizeBox = () => {\n    const url = `${productJson.url}?${Date.parse(selectedDate)}`;\n    if (typeof window.swup === 'undefined') {\n      window.location = url;\n    } else {\n      window.swup.loadPage({ url });\n    }\n  };\n\n  /**\n   * Submit cart data as made up from makeCart - also the callee\n   * TODO this is the same as for container box!!\n   * And so should be!\n   *\n   * @function submitCart\n   */\n  const submitCart = async ({ cart }) => {\n\n    const data = {\n      id: fetchJson[selectedDate].shopify_variant_id,\n      quantity: 1,\n      properties: {\n        \"Delivery Date\": selectedDate,\n        \"Including\": includedProducts.join(','),\n      }\n    };\n    const headers = {\"Content-Type\": \"application/json\"};\n    const src = \"/cart/add.js\";\n    const {error, json} = await PostFetch({src, data, headers});\n\n    const url = \"/cart\";\n    if (typeof window.swup === 'undefined') {\n      window.location = url;\n    } else {\n      window.swup.loadPage({ url });\n    }\n  };\n\n  /**\n   * Gather box includes for display, watch for dates\n   *\n   * @function init\n   */\n  const init = async () => {\n    await Fetch(`${baseUrl}current-boxes-by-product/${productJson.id}`)\n      .then(({error, json}) => {\n        if (error) {\n          fetchError = error;\n        } else {\n          if (Object.keys(json).length > 0) {\n            fetchDates = Object.keys(json);\n            //includedProducts = json[fetchDates[0]].includedProducts.map(el => el.shopify_title.replace(/^- ?/, \"\"));\n            includedProducts = json[fetchDates[0]].includedProducts;\n            fetchJson = json;\n          }\n        }\n        loading = false;\n        this.refresh();\n      })\n  };\n\n  // get loaded\n  init();\n\n  while(true) {\n    yield (\n      <Fragment>\n        { fetchError && <Error msg={fetchError} /> }\n        { loading ? <BarLoader /> : (\n          <Fragment>\n            <div class=\"w-100 pv2\">\n              { !includedProducts.length ? (\n                fetchDates.length ? (\n                  <div>Build your own box with available products.</div>\n                ) : (\n                  <div>No boxes scheduled for delivery, we will post next week's boxes shortly. Please try again later.</div>\n                )\n              ) : (\n                includedProducts.map(el => (\n                  <a\n                    href={`/products/${el.shopify_handle}`}\n                    class=\"link pointer o-90 fl f6 ph3 ma1 ba br-pill b--streamside-blue bg-transparent fg-streamside-blue\"\n                  >\n                      { el.shopify_title }\n                  </a>\n              )))}\n            </div>\n            <div class=\"cf\" />\n            { fetchDates.length ? (\n              <Fragment>\n                <div class=\"relative w-100 pt3-ns cf\">\n                  <div class={selectedDate ? \"w-100 w-third-ns fl\" : \"w-100 fl\"}>\n                    <SelectMenu\n                      id={`selectDate${productJson.id}`}\n                      menu={fetchDates.map(el => ({text: el, item: el}))}\n                      title=\"Select Date\"\n                      active={menuSelectDate}\n                    >\n                      { selectedDate ? selectedDate : \"Select delivery date\" }&nbsp;&nbsp;&nbsp;&#9662;\n                    </SelectMenu>\n                  </div>\n                  { selectedDate && (\n                    <Fragment>\n                      <div class=\"w-100 w-third-ns fl pl1\">\n                        <button\n                          type=\"button\"\n                          name=\"add\"\n                          aria-label=\"Add to cart\"\n                          class=\"di f6 ttu w-100 tracked dim outline-0 debut-yellow b--debut-brown ba ba1 bg-debut-brown br2 pa2 mb1 pointer\"\n                          onclick={submitCart}\n                        >\n                            Add to cart\n                        </button>\n                      </div>\n                      <div class=\"w-100 w-third-ns fl pl1\">\n                        <button\n                          type=\"button\"\n                          name=\"customize\"\n                          aria-label=\"Customize box\"\n                          class=\"di f6 ttu w-100 tracked dim outline-0 debut-yellow b--debut-brown ba ba1 bg-debut-brown br2 pa2 mb1 pointer\"\n                          onclick={customizeBox}\n                        >\n                          Customize box\n                        </button>\n                      </div>\n                    </Fragment>\n                  )}\n                </div>\n              </Fragment>\n            ) : (\n              <div>&nbsp;</div>\n            )}\n\n          </Fragment>\n        )}\n      </Fragment>\n    );\n  };\n}\n\nconst init = () => {\n  const content = document.querySelectorAll(\"p[name='box-content']\");\n  content.forEach(async el => {\n    const json = JSON.parse(el.parentNode.querySelector(\"script\").textContent);\n    await renderer.render(<BoxContent productJson={json} />, el);\n  });\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  // do your setup here\n  // init();\n});\n\n// imported by initialize\nexport default { init };\n","/** @jsx createElement */\n/**\n * Add to cart button\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/addToCartButton\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\n\nexport default function () {\n  return (\n    <button\n      type=\"submit\"\n      name=\"add\"\n      aria-label=\"Add to cart\"\n      class=\"product-form__cart-submit debut-yellow bg-debut-yellow br2\"\n      data-add-to-cart=\"\"\n    >\n      <span data-add-to-cart-text=\"\">Add to cart</span>{\" \"}\n      <span class=\"dn\" data-loader=\"\">\n        <svg\n          aria-hidden=\"true\"\n          focusable=\"false\"\n          role=\"presentation\"\n          class=\"icon icon-spinner\"\n          viewbox=\"0 0 20 20\"\n        >\n          <path\n            d=\"M7.229 1.173a9.25 9.25 0 1 0 11.655 11.412 1.25 1.25 0 1 0-2.4-.698 6.75 6.75 0 1 1-8.506-8.329 1.25 1.25 0 1 0-.75-2.385z\"\n            fill=\"#919EAB\"\n          ></path>\n        </svg>\n      </span>\n    </button>\n  );\n}\n","/** @jsx createElement */\n/**\n * AnimationWrapper - present a component by sliding siblings out of the way\n * and fading in, and then the reverse when uumounted\n *\n * @module app/components/AnimationWrapper\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Wrap a crank Component and provide animation functionality\n *\n * @function AnimationWrapper\n * @returns {Function} Return the wrapped component\n * @param {object} Component The component to be wrapped\n * @param {object} options Options for form and modal\n */\nfunction AnimationWrapper(Component) {\n\n  /**\n   * Wrap a crank Component and provide animation functionality\n   *\n   * @function Wrapper\n   * @yields {Element} Return the wrapped component\n   * @param {object} props Property object\n   */\n  return async function* (props) {\n\n    const animationOptions = {\n      duration: 600,\n      easing: \"ease-in-out\",\n      fill: \"both\"\n    };\n\n    const animateChildren = async (childs, targetHeight) => {\n      let animation;\n      let style;\n      let matrix;\n      let matrixMatch;\n      let deltaY;\n      let Y;\n      childs.forEach(el => {\n        style = window.getComputedStyle(el)\n        matrix = style['transform'] || style.webkitTransform || style.mozTransform;\n        matrixMatch = matrix.match(/matrix.*\\((.+)\\)/);\n        Y = 0;\n        if (matrixMatch) {\n          Y = parseInt(matrixMatch[1].split(', ')[5], 10);\n        }\n        deltaY = targetHeight + Y;\n        animation = el.animate({\n          transformOrigin: \"top left\",\n          transform: `translateY(${deltaY}px)`\n        }, animationOptions);\n      });\n      return animation;\n    };\n\n    const getChildren = (target) => {\n      const childs = [] // find all items that need to be animated out of the way\n      // find next child as node\n      //let nextChild = document.querySelector(\"#app\").nextSibling;\n      let nextChild = target.nextSibling;\n      while (nextChild) {\n        if (nextChild.nodeName !== \"#text\") childs.push(nextChild);\n        nextChild = nextChild.nextSibling;\n      }\n\n      const wrapper = document.getElementById(`wrapper-${target.id}`);\n      if (wrapper) {\n        nextChild = wrapper.nextSibling;\n        while (nextChild) {\n          if (nextChild.nodeName !== \"#text\") childs.push(nextChild);\n          nextChild = nextChild.nextSibling;\n        }\n      }\n      const app = document.getElementById(\"app\");\n      if (app) {\n        nextChild = app.nextSibling;\n        while (nextChild) {\n          if (nextChild.nodeName !== \"#text\") childs.push(nextChild);\n          nextChild = nextChild.nextSibling;\n        }\n        target.style.width = `${app.clientWidth}px`;\n      }\n      const footer = document.getElementById(\"footer\");\n      if (footer) childs.push(footer);\n      return childs;\n    };\n\n    const animateMount = async (show, targetId) => {\n      // now the component is in the dom\n      const target = document.getElementById(targetId);\n      const childs = getChildren(target);\n\n      const targetBox = target.getBoundingClientRect();\n\n      // animate out of the way\n      let targetHeight = parseInt(targetBox.height, 10);;\n      target.setAttribute(\"data-height\", targetBox.height);\n      let animation;\n      let deltaY;\n      let style;\n      let matrix;\n      let matrixMatch;\n      let Y;\n\n      if (show) { // if not here we need to handle that as an error\n        animation = await animateChildren(childs, targetHeight);\n        animation.addEventListener(\"finish\", () => {\n          target.animate({\n            opacity: 1\n          }, animationOptions);\n        });\n      } else { // target has been removed from dom so move childs back to place\n        animation = target.animate({\n          opacity: 0\n        }, animationOptions);\n        // how to ensure only move these with active object??? props change??\n        childs.forEach(el => {\n          style = window.getComputedStyle(el)\n          matrix = style['transform'] || style.webkitTransform || style.mozTransform;\n          matrixMatch = matrix.match(/matrix.*\\((.+)\\)/);\n          Y = 0;\n          if (matrixMatch) {\n            Y = parseInt(matrixMatch[1].split(', ')[5], 10);\n          }\n          deltaY = Y - targetHeight;\n          animation = el.animate({\n            transformOrigin: \"top left\",\n            transform: Y ? `translateY(${deltaY}px)` : \"none\"\n          }, animationOptions);\n        });\n      };\n    };\n\n    let currentActive = props.isActive;\n\n    for await (const props of this) {\n      this.schedule(async () => {\n        // has the refresh changed size of the wrapped component??\n        const div = document.getElementById(props.componentId);\n        if (div) {\n          const dataHeight = div.getAttribute(\"data-height\");\n          let oldHeight;\n          if (dataHeight) oldHeight = parseInt(dataHeight, 10);\n          const currentHeight = div.getBoundingClientRect().height;\n          if (dataHeight && oldHeight !== currentHeight && props.isActive) {\n            div.setAttribute(\"data-height\", currentHeight);\n            const childs = getChildren(div);\n            let targetHeight = currentHeight - oldHeight;\n            if (props.componentId === \"productSelector\") targetHeight += 30; // margins ??\n            await animateChildren(childs, targetHeight);\n          }\n        }\n      });\n      yield (\n        <div id={`wrapper-${props.componentId}`}>\n          <Component\n            {...props}\n          />\n        </div>\n      );\n\n      function awaitRender() {\n        if(!document.getElementById(props.componentId)) {\n          setTimeout(awaitRender, 100);\n        } else {\n          // wait another fraction to avoid flicker\n          setTimeout(() => animateMount(props.isActive, props.componentId), 100);\n        }\n      }\n      if (currentActive !== props.isActive) {  // only open on first round if true\n        // only make animation if changing view\n        awaitRender();\n      }\n      currentActive = props.isActive;\n    }\n  };\n}\n\nexport default AnimationWrapper;\n","/** @jsx createElement */\n/**\n * Loading indicator module\n *\n * @module app/lib/bar-loader\n * @exports {Element} BarLoader\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Loader component\n *\n * @returns {Element} DOM component\n * @example\n * { loading && <BarLoader /> }\n */\nconst BarLoader = () => (\n  <div class=\"progress-bar mt2\">\n    <span class=\"bar\">\n      <span class=\"progress\" />\n    </span>\n  </div>\n);\n\nexport default BarLoader;\n\n","/** @jsx createElement */\n/**\n * Router and starting  point of the box app.\n * Renders [crank]{@link https://www.npmjs.com/@bikeshaving/crank} elements\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/initialize\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\n\nimport Error from \"./error\";\nimport BarLoader from \"./bar-loader\";\nimport QuantityForm from \"./container/quantity-form\";\nimport SelectMenu from \"./select-menu\";\nimport Flash from \"./flash\";\nimport { Fetch, PostFetch } from \"./fetch\";\nimport { shallowEqual } from \"../lib\";\n\nconst hasOwnProp = Object.prototype.hasOwnProperty;\n/**\n * BoxApp crank component\n *\n * @function BoxApp\n * @param {object} props The property object\n * @param {object} props.productJson Shopify product data as extracted from\n * product page json script tag\n * @returns {Element} A crank DOM component\n */\nasync function* ContainerBoxApp({productJson}) {\n  /** \n   * Only required on developement site where id's don't match boxes - can be\n   * updated once we can duplicated box mongo db\n   */\n  const idMap = {\n    // small\n    \"6163982876822\": \"5571286728870\",\n    // med\n    \"6163982975126\": \"5571286794406\",\n    // med fruit\n    \"6163982844054\": \"5576573878438\",\n    // med bread\n    \"6163982942358\": \"5577031352486\",\n    // big\n    \"6163982680214\": \"5571286696102\",\n    // custom\n    \"6163982647446\": \"5598426005670\",\n  }\n  /** \n   * Only required on developement site where id's don't match boxes - can be\n   * updated once we can duplicated box mongo db\n   */\n  const variantMap = JSON.parse(document.querySelector(\"#variant-map\").textContent);\n  /**\n   * If fetching data was unsuccessful.\n   *\n   * @member fetchError\n   * @type {object|string|null}\n   */\n  let fetchError = null;\n  /**\n   * Display loading indicator while fetching data\n   *\n   * @member loading\n   * @type {boolean}\n   */\n  let loading = true;\n  /**\n   * A message to the user - on 4s fade out\n   *\n   * @member flashMessage\n   * @type {string}\n   */\n  let flashMessage = \"Please select a delivery date\";\n  /**\n   * Contains box data as collected from [api/current-boxes-by-product]{@link\n   * module:api/current-boxes-by-product}. The data uses delivery date as keys to unsorted\n   * array of box data.\n   *\n   * @member fetchJson\n   * @type {object}\n   */\n  let fetchJson = {};\n  /**\n   * Contains array of current box dates duplicating fetchJson.keys\n   *\n   * @member fetchDates\n   * @type {Array}\n   */\n  let fetchDates = [];\n  /**\n   * Base url to api\n   *\n   * @member baseUrl\n   * @type {string}\n   */\n  const baseUrl = \"https://streamsidedev.cousinsd.net/api/\";\n  /**\n   * The selected date after user select, one of fetchJson.keys\n   *\n   * @member selectedDate\n   * @type {string}\n   */\n  let selectedDate;\n  /**\n   * The selected box after user select: fetchJson[selectedDate]\n   *\n   * @member selectedBox\n   * @type {object}\n   */\n  let selectedBox;\n  /**\n   * Items included in the box, initially matches selectedBox.includedProducts unless pulling from cart data\n   * but can be edited by the user\n   *\n   * @member selectedIncludes\n   * @type {Array}\n   */\n  let selectedIncludes = [];\n  /**\n   * Items that can be included in the box, initially matches selectedBox.addOnProducts unless pulling from cart data\n   *\n   * @member possibleAddons\n   * @type {Array}\n   */\n  let possibleAddons = [];\n  /**\n   * Items excluded from the box by the user - can only be items initially in selectedBox.includedProducts\n   *\n   * @member selectedExcludes\n   * @type {Array}\n   */\n  let selectedExcludes = [];\n  /**\n   * Items added to the box by the user, can only be items found in selectedBox.addOnProducts\n   *\n   * @member selectedAddons\n   * @type {Array}\n   */\n  let selectedAddons = [];\n  /**\n   * Show box customize options\n   *\n   * @member editBoxActive\n   * @type {boolean}\n   */\n  let editBoxActive;\n  /**\n   * Show box customize options\n   *\n   * @member editBoxActive\n   * @type {boolean}\n   */\n  let editBoxActiveComplete;\n  /**\n   * Display date selection menu if active\n   *\n   * @member menuSelectDate\n   * @type {boolean}\n   */\n  let menuSelectDate= false;\n  /**\n   * Display add product menu if active\n   *\n   * @member menuAddItem\n   * @type {boolean}\n   */\n  let menuAddItem = false;\n  /**\n   * Display remove product menu if active\n   *\n   * @member menuRemoveItem\n   * @type {boolean}\n   */\n  let menuRemoveItem = false;\n  /**\n   * Display edit quantities form modal\n   *\n   * @member modalQtyForm\n   * @type {boolean}\n   */\n  let modalQtyForm = false;\n  /**\n   * The price element - updated on change, and set after fetch\n   *\n   * @member priceElement\n   * @type {Element}\n   */\n  let priceElement;\n  /**\n   * The total price TODO here in development udating on refresh - production\n   * may actuall use priceElement as above\n   *\n   * @member priceElement\n   * @type {Element}\n   */\n  let totalPrice = productJson.variants[0].price;\n  /**\n   * Have we loaded data from an existing cart?\n   *\n   * @member loadedFromCart\n   * @type {boolean} false\n   */\n  let loadedFromCart = false;\n  /**\n   * Store height of the edit form to animate its display\n   *\n   * @member boxEditHeight\n   * @type {number} 0\n   */\n  let boxEditHeight = 0;\n  /**\n   * Make up a string price\n   *\n   * @param {number} num The integer number to use\n   * @returns {string} Price string\n   */\n  const toPrice = (num) => `$${(num * 0.01).toFixed(2)}`;\n  /**\n   * Figure the price for the element, if it's a standard included product only\n   * extra quantities greater than one incur a price\n   *\n   * @param {object} el The target element\n   * @param {boolean} includes Is this a standard included product?\n   * @returns {string} Price string\n   */\n  const getPrice = (el, includes) => toPrice(el.shopify_price * (includes ? el.quantity - 1 : el.quantity));\n\n  /**\n   * Update priceElement on relevant changes\n   *\n   * @function updatePriceElement\n   */\n  const updatePriceElement = () => {\n    let start = selectedBox.shopify_price;\n    selectedIncludes.forEach(el => {\n      if (el.quantity > 1) start += el.shopify_price * (el.quantity - 1);\n    });\n    selectedAddons.forEach(el => {\n      start += el.shopify_price * el.quantity;\n    });\n    totalPrice = start;\n    // ensure that this.refresh is called\n    document.querySelector(\"#product-price\").innerHTML = `$${(totalPrice * 0.01).toFixed(2)}`;\n  };\n\n  /**\n   * Move product between product lists of addon, excludes etc\n   *\n   * @function moveItem\n   * @param id {number} The shopify_id of the product\n   * @param from {array} The list to remove item from\n   * @param to {array} The list to add the item to\n   */\n  const moveItem = (id, from, to) => {\n    let i;\n    for (i = 0; i < from.length; i++) {\n      if (from[i].shopify_id === id) {\n        to.push(from[i]);\n        from.splice(i, 1);\n      }\n    }\n    updatePriceElement();\n  };\n\n  /**\n   * Load the product items\n   *\n   * @function loadBox\n   * @param date {string} The selected date\n   */\n  const loadBox = () => {\n    // may have upped the quantity of standard included product\n    const checkLoadPresence = (product) => {\n      const found = selectedIncludes.find(el => el.shopify_variant_id === product.shopify_variant_id);\n      if (typeof found === \"undefined\") return false;\n      return found;\n    }\n\n    selectedIncludes = selectedBox.includedProducts.map(el => {\n      const item = {...el};\n      item.shopify_title = el.shopify_title.replace(/^- ?/, '');\n      const found = checkLoadPresence(el);\n      item.quantity = found ? found.quantity : 1;\n      return item;\n    });\n    possibleAddons = selectedBox.addOnProducts.map(el => {\n      const item = {...el};\n      item.shopify_title = el.shopify_title.replace(/^- ?/, '');\n      item.quantity = 1;\n      return item;\n    });\n\n    // TODO find another smarter, cleaner way to do this. The purpose of this\n    // algorithm is to match addons and excludes when switching between dates\n    // and so is not done initially when loading cart data.\n\n    // tmp arrays for filter tests\n    let tmpIncludedIds = selectedIncludes.map(el => el.shopify_id);\n    let tmpAddonIds = possibleAddons.map(el => el.shopify_id);\n\n    selectedExcludes = selectedExcludes.filter(el => tmpIncludedIds.includes(el.shopify_id));\n    selectedAddons = selectedAddons.filter(el => tmpAddonIds.includes(el.shopify_id));\n\n    // re-build tmp arrays\n    tmpIncludedIds = selectedExcludes.map(el => el.shopify_id);\n    tmpAddonIds = selectedAddons.map(el => el.shopify_id);\n\n    selectedIncludes = selectedIncludes.filter(el => !tmpIncludedIds.includes(el.shopify_id));\n    possibleAddons = possibleAddons.filter(el => !tmpAddonIds.includes(el.shopify_id));\n\n    totalPrice = selectedBox.shopify_price;\n  };\n\n  /**\n   * Set the selected box and set up product arrays, called after selecting\n   * date.\n   *\n   * @function selectBox\n   * @param date {string} The selected date\n   */\n  const selectBox = async (date) => {\n    selectedDate = date;\n    if (!hasOwnProp.call(fetchJson, selectedDate)) {\n      loading = false;\n      this.refresh();\n      const ts = new Date(date).getTime();\n      await Fetch(`${baseUrl}box-by-date-and-product/${idMap[productJson.id]}/${ts}`)\n        .then(({error, json}) => {\n          if (error) {\n            fetchError = error;\n          } else {\n            fetchJson[selectedDate] = json;\n            selectedBox = fetchJson[selectedDate];\n            loadBox();\n          }\n          loading = false;\n          this.refresh();\n        })\n    } else {\n      selectedBox = fetchJson[selectedDate];\n      loadBox();\n      this.refresh();\n    }\n  };\n\n  /**\n   * Handle change on selected input elements\n   *\n   * @function handleChange\n   * @param {object} ev The firing event\n   * @listens change\n   */\n  const handleChange = (ev) => {\n    if (ev.target.tagName === \"INPUT\") {\n      if (ev.target.name === \"quantity\") {\n        switch(ev.target.getAttribute(\"data-id\")) {\n          case \"includes\":\n            selectedIncludes.forEach(el => {\n              if (el.shopify_id === ev.target.id) {\n                if (parseInt(ev.target.value) === 0) {\n                  el.quantity = 1;\n                  flashMessage = `${el.shopify_title} removed.`;\n                  moveItem(el.shopify_id, selectedIncludes, selectedExcludes);\n                } else {\n                  el.quantity = ev.target.value;\n                  flashMessage = `${el.shopify_title} quantity changed to ${el.quantity}.`;\n                }\n              }\n            });\n            break;\n          case \"addons\":\n            selectedAddons.forEach(el => {\n              if (el.shopify_id === ev.target.id) {\n                if (parseInt(ev.target.value) === 0) {\n                  el.quantity = 1;\n                  flashMessage = `Add on ${el.shopify_title} removed.`;\n                  moveItem(el.shopify_id, selectedAddons, possibleAddons);\n                } else {\n                  el.quantity = ev.target.value;\n                  flashMessage = `${el.shopify_title} quantity changed to ${el.quantity}.`;\n                }\n              }\n            });\n            break;\n        }\n        updatePriceElement();\n        this.refresh();\n      }\n    }\n  };\n\n  this.addEventListener(\"change\", handleChange);\n\n  /**\n   * Set up edit box either when page loaded from collection and choosing to\n   * edit box or after selecting checkbox\n   *\n   * @function handleEditBoxActive\n   */\n  const handleEditBoxActive = async (ev) => {\n    const boxEdit = document.getElementById(\"container-box-edit\");\n    const description = document.querySelector(\"#product-description\");\n    const footer = document.querySelector(\"#footer\");\n    const addButton = document.querySelector(\"#add-button\");\n    if (boxEdit) {\n      boxEdit.style.width = `${description.clientWidth}px`;\n      const boxEditRect = boxEdit.getBoundingClientRect();\n      boxEditHeight = boxEditRect.height;\n    };\n    console.log('no box here', boxEdit);\n\n    // animate out of the way\n    const deltaY = boxEditHeight;\n    let animation;\n\n    let keyFrames = {\n      duration: 600,\n      easing: \"ease-in-out\",\n      fill: \"both\"\n    };\n\n    if (boxEdit) {\n      [description, footer, addButton].forEach(el => {\n        animation = el.animate([{\n          transformOrigin: \"top left\",\n          transform: `translate(0px, ${deltaY}px)`\n        }], keyFrames);\n        animation.addEventListener(\"finish\", () => {\n          boxEdit.classList.add(\"transition-fade\");\n        });\n      });\n    } else {\n      [description, footer, addButton].forEach(el => {\n        animation = el.animate([{\n          transformOrigin: \"top left\",\n          transform: \"none\"\n        }], keyFrames);\n      });\n    };\n  };\n\n  /**\n   * Handle click event on selected elements\n   *\n   * @function handleClick\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleClick = async (ev) => {\n    if (ev.target.tagName === \"INPUT\") {\n      if (ev.target.type === \"checkbox\" && ev.target.id === \"toggleEditBox\") {\n\n        if (!editBoxActiveComplete === null) editBoxActiveComplete = null;\n        editBoxActive = !editBoxActive;\n        await this.refresh();\n\n        handleEditBoxActive();\n      }\n    }\n  };\n\n  this.addEventListener(\"click\", handleClick);\n\n  /**\n   * Handle mouse up on selected components\n   *\n   * @function handleMouseUp\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleMouseUp = (ev) => {\n    if (ev.target.tagName === \"BUTTON\") {\n\n      switch(ev.target.id) {\n        case \"selectDate\":\n          menuSelectDate = !menuSelectDate;\n          modalQtyForm = menuRemoveItem = menuAddItem = false;\n          this.refresh()\n          break;\n        case \"removeItem\":\n          menuRemoveItem = !menuRemoveItem;\n          modalQtyForm = menuSelectDate = menuAddItem = false;\n          this.refresh()\n          break;\n        case \"addItem\":\n          menuAddItem= !menuAddItem;\n          modalQtyForm = menuRemoveItem = menuSelectDate = false;\n          this.refresh()\n          break;\n        case \"qtyForm\":\n          modalQtyForm= !modalQtyForm;\n          menuSelectDate = menuRemoveItem = menuSelectDate = false;\n          this.refresh()\n          break;\n        case \"qtyFormClose\":\n          modalQtyForm= false;\n          this.refresh()\n          break;\n      }\n\n    } else if (ev.target.tagName === \"DIV\") {\n\n      switch(ev.target.getAttribute(\"name\")) {\n        case \"selectDate\":\n          const date = ev.target.getAttribute(\"data-item\");\n          if (typeof selectedDate === 'undefined') {\n            flashMessage = `Delivery date chosen ${date}`;\n          } else {\n            flashMessage = `Delivery date changed to ${date}`;\n          }\n          selectBox(date);\n          menuSelectDate = false;\n          this.refresh()\n          break;\n        case \"removeItem\":\n          flashMessage = `${ev.target.getAttribute(\"data-title\")} removed.`;\n          moveItem(ev.target.getAttribute(\"data-item\"), selectedIncludes, selectedExcludes);\n          menuRemoveItem = false;\n          this.refresh()\n          break;\n        case \"addItem\":\n          flashMessage = `${ev.target.getAttribute(\"data-title\")} added.`;\n          moveItem(ev.target.getAttribute(\"data-item\"), possibleAddons, selectedAddons);\n          menuAddItem = false;\n          this.refresh()\n          break;\n        case \"selectedAddon\":\n          flashMessage = `Add on ${ev.target.getAttribute(\"data-title\")} removed.`;\n          moveItem(ev.target.getAttribute(\"data-item\"), selectedAddons, possibleAddons);\n          this.refresh()\n          break;\n        case \"selectedExclude\":\n          flashMessage = `${ev.target.getAttribute(\"data-title\")} added back.`;\n          moveItem(ev.target.getAttribute(\"data-item\"), selectedExcludes, selectedIncludes);\n          this.refresh()\n          break;\n      }\n    }\n  };\n\n  this.addEventListener(\"mouseup\", handleMouseUp);\n\n  /**\n   * Uses fetch to collect current boxes from api and then refreshs `this`\n   * (Called as soon as the element is mounted.)\n   *\n   * @function fetchData\n   */\n  const fetchData = async () => {\n    const fetchUrl = `${baseUrl}current-boxes-by-product/${idMap[productJson.id]}`;\n    const {error, json} = await Fetch(fetchUrl);\n    if (error) {\n      fetchError = error;\n    } else {\n      fetchJson = json;\n      fetchDates = Object.keys(fetchJson);\n      // if only one bypass the date select\n      if (fetchDates.length === 1) {\n        selectBox(fetchDates[0]); // be wary - do we need to refresh component?\n        flashMessage = \"\";\n      }\n    }\n    loading = false;\n    this.refresh();\n  };\n\n  /**\n   * Uses fetch to collect current dates from api\n   *\n   * @function fetchCurrentDates\n   */\n  const fetchCurrentDates = async () => {\n    const fetchUrl = `${baseUrl}current-box-dates`;\n    const {error, json} = await Fetch(fetchUrl);\n    if (error) {\n      fetchError = error;\n    } else {\n      fetchDates = json;\n      if (fetchDates.length === 1) {\n        selectBox(fetchDates[0]); // this causes a flicket because drop down already rendered\n        flashMessage = \"\";\n      }\n    }\n    loading = false;\n    //this.refresh();\n  };\n\n  /**\n   * Load current cart if cart.items.length - called from `fetchCart` which is caalled immdiately the component loads\n   */\n  const loadCart = async (cart) => {\n    // product_type from liquid object would be (?) cart.items[x].product.type\n    const [box] = cart.items.filter(el => el.product_type === \"Container Box\");\n    selectedDate = box.properties[\"Delivery Date\"];\n\n    // loading dates can happen asynchronously to loading selected box\n    await Fetch(`${baseUrl}current-box-dates`)\n      .then(({error, json}) => {\n        if (error) {\n          fetchError = error;\n        } else {\n          fetchDates = json;\n        }\n        this.refresh();\n      })\n\n    fetchBox({ box, cart });\n  };\n\n  /**\n   * Uses fetch to collect current cart for the session \n   *\n   * @function fetchBox\n   */\n  const fetchBox = async ({ box, cart }) => {\n    // get the box data\n    if (!selectedDate) {\n      console.warn(\"Calling loadBox with no selectedDate\");\n      return;\n    };\n    const ts = new Date(selectedDate).getTime();\n    await Fetch(`${baseUrl}box-by-date-and-product/${idMap[productJson.id]}/${ts}`)\n      .then(({error, json}) => {\n        if (error) {\n          fetchError = error;\n        } else {\n          fetchJson[selectedDate] = json;\n          selectedBox = fetchJson[selectedDate];\n\n          const removedItems = box ? box.properties[\"Removed Items\"].split(',').map(el => el.trim()) : [];\n\n          // get the excluded items\n          selectedExcludes = selectedBox.includedProducts\n            .filter(el => removedItems.includes(el.shopify_title));\n\n          const checkPresence = (product) => {\n            if (!cart) return false;\n            const found = cart.items.find(el => el.variant_id === product.shopify_variant_id);\n            if (typeof found === \"undefined\") return false;\n            return found;\n          }\n\n          // get the included box items filtering out those already excluded if loaded from cart\n          selectedIncludes = selectedBox.includedProducts\n            .filter(el => !removedItems.includes(el.shopify_title))\n            .map(el => {\n              const item = {...el};\n              item.shopify_title = el.shopify_title.replace(/^- ?/, '');\n              const found = checkPresence(el);\n              item.quantity = found ? found.quantity + 1 : 1;\n              return item;\n            });\n          // get the addon products and their quantity if loaded from cart\n          selectedAddons = selectedBox.addOnProducts\n            .filter(el => checkPresence(el))\n            .map(el => {\n              const item = {...el};\n              item.shopify_title = el.shopify_title.replace(/^- ?/, '');\n              const found = checkPresence(el);\n              item.quantity = found.quantity;\n              return item;\n            });\n          // get defined possible addons filtering out those that have been added o the cart\n          possibleAddons = selectedBox.addOnProducts\n            .filter(el => !checkPresence(el))\n            .map(el => {\n              const item = {...el};\n              item.shopify_title = el.shopify_title.replace(/^- ?/, '');\n              item.quantity = 1;\n              return item;\n            });\n          }\n        loading = false;\n        updatePriceElement();\n        flashMessage = \"Loaded box from your cart\";\n        loadedFromCart = true;\n        this.refresh();\n      })\n  };\n\n  /**\n   * Uses fetch to collect current cart for the session \n   *\n   * @function fetchCart\n   */\n  const fetchCart = async () => {\n      /*\n    const json = JSON.parse(document.querySelector(\"#cart-json\").textContent);\n    if (json.items.length === 0) {\n      fetchCurrentDates();\n    } else {\n      loadCart(json);\n    }\n    */\n    const {error, json} = await Fetch(\"/cart.js\");\n    if (error) {\n      fetchError = error;\n      this.refresh();\n    } else {\n      if (!json.items) throw \"Failed to load cart data\";\n      if (json.items.length === 0) {\n        fetchCurrentDates();\n      } else {\n        loadCart(json);\n      }\n    }\n  };\n\n  /**\n   * Submit cart data as made up from makeCart - also the callee\n   *\n   */\n  const submitCart = async ({ cart }) => {\n\n    const data = {\n      items: cart.items.map(item => {\n        return {\n          id: variantMap[item.variant_id],\n          quantity: item.quantity,\n          properties: item.properties\n        }\n      })\n    };\n    const headers = {\"Content-Type\": \"application/json\"};\n    const src = \"/cart/add.js\";\n    const {error, json} = await PostFetch({src, data, headers});\n    const url = \"/cart\";\n    if (typeof window.swup === 'undefined') {\n      window.location = url;\n    } else {\n      window.swup.loadPage({ url });\n    }\n  };\n\n  /**\n   * Make up cart data for submission. Doing this is a simple as submitting to\n   * cart/add.js with an array of items\n   *\n   * TODO: Not in necessary - could call submitCart directly - see collection.js for example\n   *\n   */\n  const makeCart = () => {\n    const cart = {};\n    cart.total_price = totalPrice;\n\n    const makeTitle = (el) => {\n      let title = el.shopify_title;\n      if (el.quantity > 1) {\n        title = `${title} (${el.quantity})`;\n      }\n      return title\n    };\n\n    cart.items = [];\n    // first item is the box itself\n    cart.items.push({\n      quantity: 1,\n      title: selectedBox.shopify_title,\n      product_id: selectedBox.shopify_product_id,\n      variant_id: selectedBox.shopify_variant_id,\n      handle: selectedBox.shopify_handle,\n      product_type: \"Container Box\",\n      properties: {\n        \"Delivery Date\": selectedDate,\n        \"Including\": selectedIncludes.map(el => makeTitle(el)).join(),\n        \"Removed Items\": selectedExcludes.map(el => el.shopify_title).join(),\n        //\"Add on Items\": selectedAddons.map(el => makeTitle(el)).join()\n      }\n    })\n    // following that are any addon items\n    selectedAddons.forEach(el => {\n      cart.items.push({\n        quantity: el.quantity,\n        title: el.shopify_title,\n        product_id: el.shopify_product_id,\n        variant_id: el.shopify_variant_id,\n        handle: el.shopify_handle,\n        product_type: \"Box Produce\",\n        properties: {\n          \"Delivery Date\": selectedDate,\n          \"Add on product to\": selectedBox.shopify_title\n        }\n      })\n    })\n    // following that are any addon items that are already included in box but are extras\n    selectedIncludes.forEach(el => {\n      if (el.quantity > 1) {\n        cart.items.push({\n          quantity: el.quantity - 1,\n          title: el.shopify_title,\n          product_id: el.shopify_product_id,\n          variant_id: el.shopify_variant_id,\n          handle: el.shopify_handle,\n          product_type: \"Box Produce\",\n          properties: {\n            \"Delivery Date\": selectedDate,\n            \"Add on product to\": selectedBox.shopify_title\n          }\n        })\n      }\n    })\n\n    // this is of the same structure as a fetched cart\n    submitCart({ cart });\n  }\n\n  fetchCart(); // the first thing to happem\n\n  if (window.location.search) {\n    // we have a selected date coming for the collection - TODO check for cart or handle from the collection\n    const d = new Date(parseInt(window.location.search.slice(1)));\n    selectedDate = d.toDateString();\n    editBoxActive = true;\n    editBoxActiveComplete = true;\n    fetchBox({ box: null, cart: null });\n    // fails because element not yet rendered\n    //handleEditBoxActive(); // run the algorithm to display edit options\n  }\n\n  for await ({productJson} of this) {\n    yield (\n      <div class=\"mt2 sans-serif\" id=\"container-box\">\n        { fetchError && <Error msg={fetchError} /> }\n        { !loading ? (\n          <Fragment>\n            { flashMessage && (\n              <Flash>{ flashMessage }</Flash>\n            )}\n            { (fetchDates.length > 0) ? (\n              <Fragment>\n                { !selectedDate && (\n                  <div class=\"warn fg-warn br2 w-100 ba pa1 mb2 tc\">\n                    <span class=\"f3 b pr1\">&#33;</span>\n                    Please choose a date for delivery\n                  </div>\n                )}\n\n                <div class=\"relative\">\n                  <SelectMenu\n                    id=\"selectDate\"\n                    menu={fetchDates.map(el => ({text: el, item: el}))}\n                    title=\"Select Date\"\n                    active={menuSelectDate}\n                  >\n                    { selectedDate ? selectedDate : \"Select delivery date\" }&nbsp;&nbsp;&nbsp;&#9662;\n                  </SelectMenu>\n                </div>\n              </Fragment>\n            ) : (\n              <div class=\"warn fg-warn br2 w-100 ba pa1 mb2 tc\">\n                <span class=\"f3 b pr1\">&#33;</span>\n                No boxes scheduled for delivery, please come back later.\n              </div>\n            )}\n\n            { selectedBox && (\n\n              <Fragment>\n\n                { modalQtyForm && (\n                  <QuantityForm includes={selectedIncludes} addons={selectedAddons} totalPrice={totalPrice} />\n                )}\n\n                <div class=\"ttu b pt2\">Box Products</div>\n                <div class=\"w-100 bb b--silver pv2 fl cf\">\n                  {selectedIncludes.map(el => \n                    <div\n                      class=\"fl f6 ph3 ma1 ba br-pill b--streamside-blue bg-streamside-blue white\"\n                    >\n                        {el.shopify_title} {(el.quantity > 1) ? `(${el.quantity}) ${getPrice(el, true)}` : \"\"}\n                    </div>\n                  )}\n                  {selectedAddons.map(el => \n                    <div\n                      class=\"fl f6 ph3 ma1 ba br-pill b--streamside-maroon bg-streamside-maroon white pointer\"\n                      name=\"selectedAddon\"\n                      data-item={el.shopify_id}\n                      data-title={el.shopify_title}\n                    >\n                    {el.shopify_title} ({el.quantity}) {getPrice(el)} &#x2718;\n                    </div>\n                  )}\n                </div>\n\n                <div class=\"cf\" />\n\n                { selectedExcludes.length ? (\n                  <div class=\"cf\">\n                    <div class=\"ttu b\">\n                      Excluded Products\n                    </div>\n                    <div class=\"fw1 f6 gray\">\n                      A suprise item will be substitued\n                    </div>\n                    <div class=\"w-100 bb b--silver pv2 fl\">\n                      {selectedExcludes.map(el =>\n                        <div\n                          class=\"fl f6 ph3 ma1 ba br-pill b--streamside-orange bg-streamside-orange white pointer\"\n                          name=\"selectedExclude\"\n                          data-item={el.shopify_id}\n                          data-title={el.shopify_title}\n                        >\n                          {el.shopify_title} &#x2718;\n                        </div>)}\n                    </div>\n                  </div>\n                ) : \"\"}\n\n                <div class=\"w-100 pv3 gray dt\">\n                  <div class=\"dtc\">\n                    <input\n                      class=\"b--silver mr2\"\n                      type=\"checkbox\"\n                      id=\"toggleEditBox\"\n                      checked={editBoxActive}\n                    />\n                    <label\n                      for=\"toggleEditBox\"\n                      htmlFor=\"toggleEditBox\"\n                    >\n                      Customize your box\n                    </label>\n                  </div>\n                  <div class=\"dtc\">\n                    <div class=\"tr\">\n                      <button\n                        class=\"f6 outline-0 gray b--gray ba ba1 bg-transparent br2 pa1 mb1 pointer\"\n                        title=\"Change product quantities\"\n                        id=\"qtyForm\"\n                        type=\"button\"\n                        >\n                        Change quantities\n                      </button>\n                    </div>\n                  </div>\n                </div>\n\n              </Fragment>\n            )}\n\n            { selectedBox && editBoxActive && (\n              <div class={`${!editBoxActiveComplete && \"absolute o-0\" } w-100`} id=\"container-box-edit\">\n                <div>\n\n                  { (selectedIncludes.length > 0) && (\n                    <SelectMenu\n                      id=\"removeItem\"\n                      menu={selectedIncludes.map(el => ({text: el.shopify_title, item: el.shopify_id}))}\n                      title=\"Remove items from your box\"\n                      active={menuRemoveItem}\n                    >\n                      Select items you'd prefer not to receive&nbsp;&nbsp;&nbsp;&#9662;\n                    </SelectMenu>\n                  )}\n\n                  { (possibleAddons.length > 0) && (\n                    <SelectMenu\n                      id=\"addItem\"\n                      menu={possibleAddons.map(el => ({text: el.shopify_title, item: el.shopify_id}))}\n                      title=\"Add items to your box\"\n                      active={menuAddItem}\n                    >\n                      Select items you'd like to add to the box&nbsp;&nbsp;&nbsp;&#9662;\n                    </SelectMenu>\n                  )}\n\n                </div>\n\n                <div class=\"ttu b pt2\">Available Products</div>\n                <div class=\"bb b--silver pv2 fl\">\n                  {possibleAddons.map(el =>\n                    <div\n                      class=\"fl f6 ph3 ma1 ba br-pill b--streamside-maroon bg-streamside-maroon white\"\n                    >\n                        {el.shopify_title} {getPrice(el)}\n                    </div>)}\n                </div>\n                <div class=\"cf\" />\n              </div>\n            )}\n\n            { selectedDate && (\n              <button\n                type=\"submit\"\n                name=\"add\"\n                id=\"add-button\"\n                aria-label=\"Add to cart\"\n                class=\"f6 ttu w-100 tracked dim outline-0 debut-yellow b--debut-brown ba ba1 bg-debut-brown br2 pa2 mb1 pointer\"\n                data-add-to-cart=\"\"\n                onclick={makeCart}\n              >\n                <span data-add-to-cart-text=\"\">{ loadedFromCart ? \"Update selection\" : \"Add to cart\" }</span>{\" \"}\n                <span class=\"dn\" data-loader=\"\">\n                  <svg\n                    aria-hidden=\"true\"\n                    focusable=\"false\"\n                    role=\"presentation\"\n                    class=\"icon icon-spinner\"\n                    viewbox=\"0 0 20 20\"\n                  >\n                    <path\n                      d=\"M7.229 1.173a9.25 9.25 0 1 0 11.655 11.412 1.25 1.25 0 1 0-2.4-.698 6.75 6.75 0 1 1-8.506-8.329 1.25 1.25 0 1 0-.75-2.385z\"\n                      fill=\"#919EAB\"\n                    ></path>\n                  </svg>\n                </span>\n              </button>\n            )}\n          </Fragment>\n        ) : <BarLoader />}\n\n      </div>\n    );\n  };\n}\n\nexport default ContainerBoxApp;\n","/** @jsx createElement */\n/**\n * Router and starting  point of the box app.\n * Renders [crank]{@link https://www.npmjs.com/@bikeshaving/crank} elements\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/initialize\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\n\nimport Error from \"./error\";\nimport BarLoader from \"./bar-loader\";\nimport QuantityForm from \"./container/quantity-form\";\nimport SelectMenu from \"./select-menu\";\nimport Flash from \"./flash\";\nimport AnimationWrapper from \"./animation-wrapper\";\nimport { Fetch, PostFetch } from \"./fetch\";\nimport { shallowEqual } from \"../lib\";\n\nconst Paragraph = () => (\n  <p id=\"myText\" class=\"absolute o-0 tl lh-copy black-60 mh0 mv2\">\n    Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod\n    tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim\n    veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea\n    commodo consequat. Duis aute irure dolor in reprehenderit in voluptate\n    velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint\n    occaecat cupidatat non proident, sunt in culpa qui officia deserunt\n    mollit anim id est laborum.\n  </p>\n);\n\nconst TextParagraph = AnimationWrapper(Paragraph);\n\n/**\n * ContainerBoxApp crank component\n *\n * @generator ContainerBoxApp\n * @param {object} props The property object\n * @param {object} props.productJson Shopify product data as extracted from\n * product page json script tag\n * @yields {Element} A crank DOM component\n */\nasync function* ContainerBoxApp({ productJson }) {\n  /**\n   * Only required on developement site where id's don't match boxes - can be\n   * updated once we can duplicated box mongo db\n   */\n  const idMap = {\n    // small\n    6163982876822: \"5571286728870\",\n    // med\n    6163982975126: \"5571286794406\",\n    // med fruit\n    6163982844054: \"5576573878438\",\n    // med bread\n    6163982942358: \"5577031352486\",\n    // big\n    6163982680214: \"5571286696102\",\n    // custom\n    6163982647446: \"5598426005670\",\n  };\n  /**\n   * If fetching data was unsuccessful.\n   *\n   * @member fetchError\n   * @type {object|string|null}\n   */\n  let fetchError = null;\n  /**\n   * Display loading indicator while fetching data\n   *\n   * @member loading\n   * @type {boolean}\n   */\n  let loading = true;\n  /**\n   * Base url to api\n   *\n   * @member baseUrl\n   * @type {string}\n   */\n  const baseUrl = \"https://streamsidedev.cousinsd.net/api/\";\n  /**\n   * Contains box data as collected from [api/current-boxes-by-product]{@link\n   * module:api/current-boxes-by-product}. The data uses delivery date as keys to unsorted\n   * array of box data.\n   *\n   * @member fetchJson\n   * @type {object}\n   */\n  let fetchJson = {};\n  /**\n   * Upcoming delivery dates\n   *\n   * @member fetchDates\n   * @type {object}\n   */\n  let fetchDates = [];\n  /**\n   * Show box customize options\n   *\n   * @member editBoxActive\n   * @type {boolean}\n   */\n  let editBoxActive;\n  /**\n   * Contains cart data collected from html template json data\n   * This will then also contain a selected date\n   *\n   * @member cartJson\n   * @type {object}\n   */\n  const cartJson = await JSON.parse(\n    document.querySelector(\"#cart-json\").textContent\n  );\n\n  const handleEditBoxActive = async (show) => {\n    console.log(editBoxActive);\n    if (show) {\n      // insert the component with \"absolute o-0\"\n      await this.refresh();\n      console.log('refreshing yes');\n      // when unmounting component do this last!!\n    }\n\n    const targetId = \"myText\";\n    // now the component is in the dom\n    const target = document.getElementById(targetId);\n    console.log(target);\n\n    const childs = [] // find all items that need to be animated out of the way\n    // find next child as node\n    //let nextChild = document.querySelector(\"#app\").nextSibling;\n    let nextChild = target.nextSibling;\n    while (nextChild) {\n      if (nextChild.nodeName !== \"#text\") childs.push(nextChild);\n      nextChild = nextChild.nextSibling;\n    }\n    const app = document.getElementById(\"app\");\n    nextChild = app.nextSibling;\n    while (nextChild) {\n      if (nextChild.nodeName !== \"#text\") childs.push(nextChild);\n      nextChild = nextChild.nextSibling;\n    }\n    const footer = document.getElementById(\"footer\");\n    if (footer) childs.push(footer);\n\n    // set width to app width\n    target.style.width = `${app.clientWidth}px`;\n\n    const options = {\n      duration: 600,\n      easing: \"ease-in-out\",\n      fill: \"both\"\n    };\n\n    const targetBox = target.getBoundingClientRect();\n\n    // animate out of the way\n    const deltaY = targetBox.height;\n    let animation;\n\n    if (show) { // if not here we need to handle that as an error\n      childs.forEach(el => {\n        animation = el.animate([{\n          transformOrigin: \"top left\",\n          transform: `translate(0px, ${deltaY}px)`\n        }], options);\n      });\n      animation.addEventListener(\"finish\", () => {\n        target.animate([{\n          opacity: 1\n        }], options);\n      });\n    } else { // target has been removed from dom so move childs back to place\n      let childanimation;\n      animation = target.animate([{\n        opacity: 0\n      }], options);\n      //animation.addEventListener(\"finish\", () => {\n      childs.forEach(el => {\n        childanimation = el.animate([{\n          transformOrigin: \"top left\",\n          transform: \"none\"\n        }], options);\n      });\n      childanimation.addEventListener(\"finish\", () => {\n        this.refresh();\n      });\n      //})\n    };\n  };\n\n  /**\n   * Gather box includes for display, watch for dates\n   *\n   * @function getData\n   */\n  const getData = async () => {\n    await Fetch(\n      `${baseUrl}current-boxes-by-product/${idMap[productJson.id]}`\n    ).then(({ error, json }) => {\n      if (error) {\n        fetchError = error;\n      } else {\n        if (Object.keys(json).length > 0) {\n          fetchDates = Object.keys(json);\n          fetchJson = json;\n          console.log(fetchDates);\n        }\n      }\n      // ok, I've got the dates and all data needed to start presenting\n      // However we may already have a selected date from location.search query string or from cartdata\n      // components which I then want to animate into view by o\n      // 1. await refresh\n      // 2. animated child siblings down\n      // 3. animated fade to o-1 of the rendered element\n      // This will be the common pattern - use a wrapper??\n\n\n      // in both the following circumstances we should present entire edit box\n      if (cartJson.items) {\n        // find the selected date from the items\n        for (item of cartJson.items) {\n          console.warn(item);\n          if (item.product.id === productJson.id) {\n            // ??\n            selectedDate = item.properties[\"Delivery Date\"];\n            editBoxActive = true;\n            //fetchBox({ box: box, cart: cartJson }); // ???\n            break;\n          }\n        }\n      }\n      if (window.location.search) {\n        // use the selected date\n        const d = new Date(parseInt(window.location.search.slice(1), 10));\n        selectedDate = d.toDateString();\n        editBoxActive = true;\n        //fetchBox({ box: null, cart: null });\n      }\n\n      loading = false;\n      editBoxActive = true;\n      this.refresh();\n\n    });\n    if (editBoxActive) {\n      function awaitRender() {\n        console.log('checking');\n        if(!document.getElementById(\"myText\")) {\n          setTimeout(awaitRender, 100);\n        } else {\n          // wait another fraction to avoid flicker\n          setTimeout(() => handleEditBoxActive(editBoxActive), 200);\n        }\n      }\n      awaitRender();\n    }\n  };\n\n  await getData();\n\n  /**\n   * Handle click event on selected elements\n   *\n   * @function handleClick\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleClick = async (ev) => {\n    console.log(ev.target.tagName);\n    if (ev.target.tagName === \"INPUT\" || ev.target.tagName === \"DIV\") {\n      if ((ev.target.type === \"checkbox\" && ev.target.id === \"toggleEditBox\") || ev.target.id === \"toggleInput\") {\n\n        editBoxActive = !editBoxActive;\n\n        handleEditBoxActive(editBoxActive);\n      }\n    }\n  };\n\n  this.addEventListener(\"click\", handleClick);\n\n  for await ({ productJson } of this) {\n    yield (\n      <div class=\"mt2 sans-serif\" id=\"container-box\">\n        {loading ? (\n          <BarLoader />\n        ) : (\n          <Fragment>\n            <input\n              class=\"b--silver mr2\"\n              type=\"checkbox\"\n              id=\"toggleEditBox\"\n              checked={editBoxActive}\n            />\n            <label\n              for=\"toggleEditBox\"\n              htmlFor=\"toggleEditBox\"\n            >\n              Customize your box\n            </label>\n            { editBoxActive && <TextParagraph /> }\n          </Fragment>\n        )}\n      </div>\n    );\n  }\n}\n\nexport default ContainerBoxApp;\n","/** @jsx createElement */\n/**\n * Router and starting  point of the box app.\n * Renders [crank]{@link https://www.npmjs.com/@bikeshaving/crank} elements\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/initialize\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\n\nimport Error from \"./error\";\nimport BarLoader from \"./bar-loader\";\nimport SelectMenu from \"./select-menu\";\nimport Flash from \"./flash\";\nimport AnimationWrapper from \"./animation-wrapper\";\nimport { Fetch, PostFetch } from \"./fetch\";\nimport { shallowEqual } from \"../lib\";\nimport { selectDateEvent, selectorOpenEvent, moveProductEvent, quantityUpdateEvent } from \"./events\";\nimport getPrice from \"./price\";\nimport DateSelector from \"./container/date-selector\";\nimport BoxProducts from \"./container/box-products\";\nimport QuantityForm from \"./container/quantity-form\";\nimport ProductSelector from \"./container/product-selector\";\nimport { sortObjectByKey } from \"../helpers\";\n\nconst hasOwnProp = Object.prototype.hasOwnProperty;\n/**\n * ContainerBoxApp crank component\n *\n * @generator ContainerBoxApp\n * @param {object} props The property object\n * @param {object} props.productJson Shopify product data as extracted from\n * product page json script tag\n * @yields {Element} A crank DOM component\n */\nasync function* ContainerBoxApp({ productJson }) {\n  /**\n   * If fetching data was unsuccessful.\n   *\n   * @member fetchError\n   * @type {object|string|null}\n   */\n  let fetchError = null;\n  /**\n   * Display loading indicator while fetching data\n   *\n   * @member loading\n   * @type {boolean}\n   */\n  let loading = true;\n  /**\n   * Base url to api\n   *\n   * @member baseUrl\n   * @type {string}\n   */\n  const baseUrl = \"https://streamsidedev.cousinsd.net/api/\";\n  /**\n   * Contains box data as collected from [api/current-boxes-by-product]{@link\n   * module:api/current-boxes-by-product}. The data uses delivery date as keys to unsorted\n   * array of box data.\n   *\n   * @member fetchJson\n   * @type {object}\n   */\n  let fetchJson = {};\n  /**\n   * Upcoming delivery dates, same as Object.keys(fetchJson)\n   *\n   * @member fetchDates\n   * @type {object}\n   */\n  let fetchDates = [];\n  /**\n   * The selected date after user select, one of fetchJson.keys\n   *\n   * @member selectedDate\n   * @type {string}\n   */\n  let selectedDate;\n  /**\n   * The selected box : fetchJson[selectedDate]\n   *\n   * @member selectedBox\n   * @type {object}\n   */\n  let selectedBox;\n  /**\n   * Items included in the box, initially matches selectedBox.includedProducts unless pulling from cart data\n   * but can be edited by the user\n   *\n   * @member selectedIncludes\n   * @type {Array}\n   */\n  let selectedIncludes = [];\n  /**\n   * Items that can be included in the box, initially matches selectedBox.addOnProducts unless pulling from cart data\n   *\n   * @member possibleAddons\n   * @type {Array}\n   */\n  let possibleAddons = [];\n  /**\n   * Items excluded from the box by the user - can only be items initially in selectedBox.includedProducts\n   *\n   * @member selectedExcludes\n   * @type {Array}\n   */\n  let selectedExcludes = [];\n  /**\n   * Items added to the box by the user, can only be items found in selectedBox.addOnProducts\n   *\n   * @member selectedAddons\n   * @type {Array}\n   */\n  let selectedAddons = [];\n  /**\n   * The total price TODO here in development udating on refresh - production\n   * may actuall use priceElement as above\n   *\n   * @member priceElement\n   * @type {Element}\n   */\n  let totalPrice = productJson.variants[0].price;\n  /**\n   * Show box flag - using this to animate in after loading\n   *\n   * @member showBoxActive\n   * @type {boolean}\n   */\n  let showBoxActive = false;\n  /**\n   * Show box customize options - used to animate in the options\n   *\n   * @member editBoxActive\n   * @type {boolean}\n   */\n  let editBoxActive = false;\n  /**\n   * Display edit quantities form modal\n   *\n   * @member modalQtyForm\n   * @type {boolean}\n   */\n  let modalQtyForm = false;\n  /**\n   * Have we loaded data from an existing cart?\n   *\n   * @member loadedFromCart\n   * @type {boolean} false\n   */\n  let loadedFromCart = false;\n  /**\n   * Hold on to the product id of the box in the cart, useful to easily check\n   * if this box is the same as in the cart, particulary as we only allow one\n   * box per order\n   *\n   * @member cartBoxId\n   * @type {number} false\n   */\n  let cartBoxId = null;\n  /**\n   * Extra items in the current cart, stored as object of id: quantity\n   *\n   * @member cartAddons\n   * @type {object}\n   */\n  const cartAddons = {};\n  /**\n   * Removed items recorded in the current cart\n   *\n   * @member cartRemovedItems\n   * @type {Array}\n   */\n  let cartRemovedItems = [];\n  /**\n   * Contains cart data collected from html template json data\n   * This will then also contain a selected date\n   *\n   * @member cartJson\n   * @type {object}\n   */\n  const cartJson = await JSON.parse(\n    document.querySelector(\"#cart-json\").textContent\n  );\n  /**\n   * Load the product items after selectedBox is made\n   *\n   * @function loadBox\n   */\n  const loadBox = () => {\n    // may have upped the quantity of standard included product\n    const checkLoadPresence = (product) => {\n      const found = selectedIncludes.find(el => el.shopify_variant_id === product.shopify_variant_id);\n      if (typeof found === \"undefined\") return false;\n      return found;\n    }\n\n    selectedIncludes = selectedBox.includedProducts.map(el => {\n      const item = {...el};\n      const found = checkLoadPresence(el);\n      item.quantity = found ? found.quantity : 1;\n      return item;\n    });\n    possibleAddons = selectedBox.addOnProducts.map(el => {\n        const item = {...el};\n        item.quantity = 1;\n        return item;\n      })\n      .filter(el => !selectedIncludes.find(ob => ob.shopify_title === el.shopify_title));\n\n    // TODO find another smarter, cleaner way to do this. The purpose of this\n    // algorithm is to match addons and excludes when switching between dates\n    // and so is not done initially when loading cart data.\n    // SEE container-box.bak.js\n\n    // NOTE me thinks that I need to run a different routing depending on having a cart.\n\n    // handle cart inclusions - cartRemovedItems and cartAddons are collected in \"init\"\n    const cartAddonIds = Object.keys(cartAddons);\n\n    // find current addon selection that are possible for this box and use has already selected addons\n    const currentSelectedAddons = selectedAddons\n      .filter(el => possibleAddons.map(el => el.shopify_product_id).includes(el.shopify_product_id));\n    console.log('current addons', currentSelectedAddons);\n\n    console.log(possibleAddons.map(el => el.shopify_title));\n    // problem now is that I assume a cart\n    if (cartAddonIds.length) {\n      console.log('cart add ids', cartAddonIds);\n      selectedAddons = possibleAddons\n        .filter(el => cartAddonIds.includes(el.shopify_variant_id))\n        .map(el => {\n          const item = {...el};\n          if (cartAddonIds.includes(el.shopify_variant_id)) item.quantity = cartAddons[el.shopify_variant_id];\n          return item;\n        });\n    } else {\n      // but even I may have changed the selectedAddons???\n      console.log('no cart add ids', cartAddonIds);\n      selectedAddons = selectedAddons\n        .filter(el => possibleAddons.map(el => el.shopify_product_id).includes(el.shopify_product_id));\n    }\n    \n    possibleAddons = possibleAddons.filter(el => !cartAddonIds.includes(el.shopify_variant_id));\n    selectedExcludes = selectedIncludes.filter(el => cartRemovedItems.includes(el.shopify_title));\n    selectedIncludes = selectedIncludes\n      .map(el => {\n        const item = {...el};\n        if (el.shopify_title === \"Carrot bunch\") {\n        }\n        if (cartAddonIds.includes(el.shopify_variant_id)) {\n          item.quantity += cartAddons[el.shopify_variant_id];\n        }\n        return item;\n      })\n      .filter(el => !cartRemovedItems.includes(el.shopify_title));\n\n    // and what happens when the date is changed?\n\n    //totalPrice = selectedBox.shopify_price;\n    updatePriceElement();\n    //console.log(\"box loaded\");\n  };\n\n  /**\n   * Make up cart data, submit to cart.js and redirect page\n   *\n   * @function submitCart\n   */\n  const submitCart = async () => {\n\n    const makeTitle = (el) => {\n      let title = el.shopify_title;\n      if (el.quantity > 1) {\n        title = `${title} (${el.quantity})`;\n      }\n      return title\n    };\n\n    const data = {};\n    data.items = [];\n    // following that are any addon items\n    selectedAddons.forEach(el => {\n      const id = el.shopify_variant_id;\n      if (id) {\n        data.items.push({\n          quantity: el.quantity,\n          id: el.shopify_variant_id,\n          properties: {\n            \"Delivery Date\": selectedDate,\n            \"Add on product to\": selectedBox.shopify_title\n          }\n        })\n      }\n    })\n    // following that are any addon items that are already included in box but are extras\n    selectedIncludes.forEach(el => {\n      if (el.quantity > 1) {\n        data.items.push({\n          quantity: el.quantity - 1,\n          id: el.shopify_variant_id,\n          properties: {\n            \"Delivery Date\": selectedDate,\n            \"Add on product to\": selectedBox.shopify_title\n          }\n        })\n      }\n    })\n    // first item is the box itself\n    data.items.push({\n      quantity: 1,\n      id: selectedBox.shopify_variant_id,\n      properties: {\n        \"Delivery Date\": selectedDate,\n        \"Including\": selectedIncludes.map(el => makeTitle(el)).join(),\n        \"Removed Items\": selectedExcludes.map(el => el.shopify_title).join(),\n        \"Add on Items\": selectedAddons.map(el => makeTitle(el)).join()\n      }\n    })\n    const headers = {\"Content-Type\": \"application/json\"};\n    const {error: clearError, json: clearJson} = await PostFetch({src: \"/cart/clear.js\", data, headers});\n\n    if (clearError) {\n      console.warn(clearError); // what to do here??\n      return;\n    }\n\n    const {error, json} = await PostFetch({src: \"/cart/add.js\", data, headers});\n    const url = \"/cart\";\n    if (typeof window.swup === 'undefined') {\n      window.location = url;\n    } else {\n      window.swup.loadPage({ url });\n    }\n  };\n\n  /**\n   * Handle click event on selected elements\n   *\n   * @function handleClick\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleClick = async (ev) => {\n    if (ev.target.tagName === \"INPUT\" || ev.target.tagName === \"DIV\") {\n      if ((ev.target.type === \"checkbox\" && ev.target.id === \"toggleEditBox\") || ev.target.id === \"toggleInput\") {\n        editBoxActive = !editBoxActive;\n        this.refresh();\n      }\n    }\n    if (ev.target.tagName === \"BUTTON\") {\n      if (ev.target.id === \"qtyForm\") {\n        modalQtyForm= !modalQtyForm;\n        this.refresh()\n      }\n      if (ev.target.id === \"qtyFormClose\") {\n        modalQtyForm= !modalQtyForm;\n        this.refresh()\n      }\n    }\n  };\n\n  this.addEventListener(\"click\", handleClick);\n\n  /**\n   * Select the date for box\n   *\n   * @function handleDateSelect\n   * @param ev {object} The event object with ev.detail.date to be selected\n   * @listens selectDateEvent\n   */\n  const handleDateSelect = (ev) => {\n    selectedDate = ev.detail.date;\n    selectedBox = fetchJson[selectedDate];\n    loadBox();\n    showBoxActive = true;\n    this.refresh();\n  };\n  this.addEventListener(\"selectDateEvent\", handleDateSelect);\n\n  /** \n   * Map strings to the lists\n   *\n   * @function listMap\n   */\n  const listMap = (str) => {\n    let list;\n    switch(str) {\n      case 'possibleAddons':\n        list = possibleAddons;\n        break;\n      case 'selectedAddons':\n        list = selectedAddons;\n        break;\n      case 'selectedIncludes':\n        list = selectedIncludes;\n        break;\n      case 'selectedExcludes':\n        list = selectedExcludes;\n        break;\n    }\n    return list;\n  }\n  /**\n   * Update priceElement on relevant changes\n   *\n   * @function updatePriceElement\n   */\n  const updatePriceElement = () => {\n    let start = selectedBox.shopify_price;\n    selectedIncludes.forEach(el => {\n      if (el.quantity > 1) start += el.shopify_price * (el.quantity - 1);\n    });\n    selectedAddons.forEach(el => {\n      start += el.shopify_price * el.quantity;\n    });\n    totalPrice = start;\n    // ensure that this.refresh is called\n    document.querySelector(\"#product-price\").innerHTML = `$${(totalPrice * 0.01).toFixed(2)}`;\n  };\n  /**\n   * Move product between product lists of addon, excludes etc\n   * * ev.detail.id - product id\n   * * ev.detail.from - moving from this list\n   * * ev.detail.to - move to this list\n   *\n   * @function moveItem\n   * @param ev {object} The event object with ev.detail\n   * @listens moveProductEvent\n   */\n  const moveProduct = (ev) => {\n    let fromList = listMap(ev.detail.from);\n    let toList = listMap(ev.detail.to);\n    const id = ev.detail.id;\n    let i;\n    for (i = 0; i < fromList.length; i++) {\n      if (fromList[i].shopify_product_id === parseInt(id, 10)) {\n        toList.push(fromList[i]);\n        fromList.splice(i, 1);\n      }\n    }\n    toList = sortObjectByKey(toList, 'shopify_title');\n\n    updatePriceElement();\n    this.refresh();\n  };\n  this.addEventListener(\"moveProductEvent\", moveProduct);\n  /**\n   * Quantity changed by quantity form\n   * * ev.detail.id - product id\n   * * ev.detail.quantity - the value changed\n   * * ev.detail.list - the list: either selectedIncludes or selectedAddons\n   *\n   * @function quantityUpdated\n   * @param ev {object} The event object with ev.detail\n   * @listens quantityUpdateEvent\n   */\n  const quantityUpdate = (ev) => {\n    const productList = listMap(ev.detail.list);\n    let targetList;\n    if (ev.detail.list === \"selectedIncludes\") targetList = \"selectedExcludes\";\n    if (ev.detail.list === \"selectedAddons\") targetList = \"possibleAddons\";\n    productList.forEach(el => {\n      if (el.shopify_product_id === parseInt(ev.detail.id, 10)) {\n        if (parseInt(ev.detail.quantity) === 0) {\n          el.quantity = 1;\n          moveProduct({detail: {id: el.shopify_product_id, from: ev.detail.list, to: targetList}});\n        } else {\n          el.quantity = ev.detail.quantity;\n        }\n      }\n    });\n    updatePriceElement();\n    this.refresh();\n  };\n  this.addEventListener(\"quantityUpdateEvent\", quantityUpdate);\n\n  /**\n   * Gather box includes for display, watch for dates, cart items and date\n   * already selected from collection\n   *\n   * @function init\n   */\n  const init = async () => {\n    await Fetch(\n      `${baseUrl}current-boxes-by-product/${productJson.id}`\n    ).then(async ({ error, json }) => {\n      if (error) {\n        fetchError = error;\n      } else {\n        if (Object.keys(json).length > 0) {\n          fetchDates = Object.keys(json);\n          fetchJson = json;\n          if (fetchDates.length === 1) {\n            selectedDate = fetchDates[0];\n            selectedBox = fetchJson[selectedDate];\n            showBox = true;\n          }\n        }\n      }\n\n      let showBox;\n      // in both the following circumstances we should present entire edit box\n      if (cartJson.items) {\n        // find the selected date from the items\n        for (const item of cartJson.items) {\n          if (item.product_type === \"Container Box\") {\n            // get the delivery date regardless of which box\n            selectedDate = item.properties[\"Delivery Date\"];\n            // using date if available\n            if (hasOwnProp.call(fetchJson, selectedDate)) selectedBox = fetchJson[selectedDate];\n            showBox = true;\n            // can assume same removed items for a different box\n            if (hasOwnProp.call(item.properties, \"Removed Items\")) {\n              cartRemovedItems = item.properties[\"Removed Items\"].split(\",\");\n            }\n            cartBoxId = item.product_id;\n\n            if (item.product_id === productJson.id) {\n              // only now are we sure that this is the same box\n              loadedFromCart = true;\n              //fetchBox({ box: box, cart: cartJson }); // ???\n            }\n          }\n          if (item.product_type === \"Box Produce\") {\n            // these are included in the box as addons\n            cartAddons[item.variant_id] = item.quantity;\n          }\n        }\n      }\n      if (window.location.search) {\n        // use the selected date\n        const d = new Date(parseInt(window.location.search.slice(1), 10));\n        selectedDate = d.toDateString();\n        selectedBox = fetchJson[selectedDate];\n        showBox = true;\n        //fetchBox({ box: null, cart: null });\n      }\n\n\n      // either a single delivery date, or selectd date, or box in cart\n      if (showBox) {\n        loadBox();\n        this.schedule(() => {\n          setTimeout(() => { // helps to keep things smooth on load\n            showBoxActive = true;\n            this.refresh();\n          }, 300);\n        });\n      }\n\n      loading = false;\n      //moveProduct({detail: {id:\"5571290923174\", from:\"selectedIncludes\", to:\"selectedExcludes\"}});\n      this.refresh();\n\n    });\n  };\n\n  await init();  // set up script\n\n  for await ({ productJson } of this) {\n    yield (\n      <div class=\"mt2 sans-serif\" id=\"container-box\">\n        {loading ? (\n          <BarLoader />\n        ) : (\n          <Fragment>\n            { modalQtyForm && (\n              <QuantityForm selectedIncludes={selectedIncludes} selectedAddons={selectedAddons} totalPrice={totalPrice} />\n            )}\n\n            <DateSelector fetchDates={fetchDates} selectedDate={selectedDate} />\n            <BoxProducts\n              selectedIncludes={selectedIncludes}\n              selectedExcludes={selectedExcludes}\n              selectedAddons={selectedAddons}\n              isActive={showBoxActive}\n              componentId=\"defaultBox\"\n            />\n            { showBoxActive && (\n              <Fragment>\n                <div id=\"toggleInput\" class=\"pointer z-max w-100 pv3 gray dt\">\n                  <div class=\"dtc\">\n                    <input\n                      class=\"b--silver mr2\"\n                      type=\"checkbox\"\n                      id=\"toggleEditBox\"\n                      checked={editBoxActive}\n                    />\n                    <label\n                      for=\"toggleEditBox\"\n                      htmlFor=\"toggleEditBox\"\n                    class=\"pointer\"\n                    >\n                      Customize your box\n                    </label>\n                  </div>\n                  <div class=\"dtc\">\n                    <div class=\"tr\">\n                      <button\n                        class=\"f6 outline-0 gray b--gray ba ba1 bg-transparent br2 pa1 mb1 pointer\"\n                        title=\"Change product quantities\"\n                        id=\"qtyForm\"\n                        type=\"button\"\n                        >\n                        Change quantities\n                      </button>\n                    </div>\n                  </div>\n                </div>\n\n                <ProductSelector\n                  selectedIncludes={selectedIncludes}\n                  possibleAddons={possibleAddons}\n                  isActive={editBoxActive}\n                  componentId=\"productSelector\"\n                />\n\n                { selectedDate && (\n                  <Fragment>\n                    { cartBoxId && (selectedBox.shopify_product_id !== cartBoxId) && (\n                      <div class=\"warn fg-warn br2 w-100 ba mb2 tc\">\n                        <span class=\"f3 b pr1\">&#33;</span>\n                        Adding this box to your cart will remove the box currently in your cart.\n                      </div>\n                    )}\n                    <button\n                      type=\"submit\"\n                      name=\"add\"\n                      id=\"add-button\"\n                      aria-label=\"Add to cart\"\n                      class=\"f6 ttu w-100 tracked dim outline-0 debut-yellow b--debut-brown ba ba1 bg-debut-brown br2 pa2 mb1 pointer\"\n                      data-add-to-cart=\"\"\n                      onclick={submitCart}\n                    >\n                      <span data-add-to-cart-text=\"\">{ loadedFromCart ? \"Update selection\" : \"Add to cart\" }</span>{\" \"}\n                      <span class=\"dn\" data-loader=\"\">\n                        <svg\n                          aria-hidden=\"true\"\n                          focusable=\"false\"\n                          role=\"presentation\"\n                          class=\"icon icon-spinner\"\n                          viewbox=\"0 0 20 20\"\n                        >\n                          <path\n                            d=\"M7.229 1.173a9.25 9.25 0 1 0 11.655 11.412 1.25 1.25 0 1 0-2.4-.698 6.75 6.75 0 1 1-8.506-8.329 1.25 1.25 0 1 0-.75-2.385z\"\n                            fill=\"#919EAB\"\n                          ></path>\n                        </svg>\n                      </span>\n                    </button>\n                  </Fragment>\n                )}\n              </Fragment>\n            )}\n          </Fragment>\n        )}\n      </div>\n    );\n  }\n}\n  /*\n            <TextParagraph\n              isActive={editBoxActive}\n              componentId=\"myText\"\n            />\n            */\n\nexport default ContainerBoxApp;\n","/** @jsx createElement */\n/**\n * The box produst component used by container-box\n * Exported wrapped in animation wrapper\n *\n * @module app/components/container/dateSelector\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\n\nimport AnimationWrapper from \"../animation-wrapper\";\nimport getPrice from \"../price\";\nimport { moveProductEvent } from \"../events\";\n\n/**\n * Box products display, shows included as well as excluded items and addons\n *\n * @yields {Element} DOM component\n */\n\nfunction* BoxProducts({selectedIncludes, selectedAddons, selectedExcludes}) {\n\n  /**\n   * Handle mouse up on selected components\n   *\n   * @function handleMouseUp\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleMouseUp = (ev) => {\n    let id;\n    if (ev.target.tagName === \"DIV\") {\n      switch(ev.target.getAttribute(\"name\")) {\n        case \"selectedAddons\":\n          id = ev.target.getAttribute(\"data-item\");\n          this.dispatchEvent(moveProductEvent(id, \"selectedAddons\", \"possibleAddons\"));\n          break;\n        case \"selectedExcludes\":\n          id = ev.target.getAttribute(\"data-item\");\n          this.dispatchEvent(moveProductEvent(id, \"selectedExcludes\", \"selectedIncludes\"));\n          break;\n      }\n    }\n  };\n  this.addEventListener(\"mouseup\", handleMouseUp);\n\n  //for (const {selectedIncludes: newIncludes, selectedAddons: newAddons, selectedExcludes: newExcludes} of this) {\n  for ({selectedIncludes, selectedAddons, selectedExcludes} of this) {\n    yield (\n      <div id=\"defaultBox\" class=\"absolute o-0\">\n        <div class=\"ttu b pt2\">Box Products</div>\n        <div class=\"w-100 bb b--silver pv2 mb2 fl cf\">\n          { !selectedIncludes.length ? (\n              <div>Build your own box with available products.</div>\n          ) : (\n           selectedIncludes.map(el => \n            <div\n              class=\"fl f6 ph3 ma1 ba br-pill b--streamside-blue bg-streamside-blue white\"\n            >\n                {el.shopify_title} {(el.quantity > 1) ? `(${el.quantity}) ${getPrice(el, true)}` : \"\"}\n            </div>\n          ))}\n          {selectedAddons.map(el => \n            <div\n              class=\"fl f6 ph3 ma1 ba br-pill b--streamside-maroon bg-streamside-maroon white pointer\"\n              name=\"selectedAddons\"\n              data-item={el.shopify_product_id}\n              data-title={el.shopify_title}\n              title=\"Remove from your box\"\n            >\n            {el.shopify_title} ({el.quantity}) {getPrice(el)} &#x2718;\n            </div>\n          )}\n        </div>\n\n        <div class=\"cf\" />\n\n        { selectedExcludes.length ? (\n          <div class=\"cf\">\n            <div class=\"ttu b\">\n              Excluded Products\n            </div>\n            <div class=\"fw1 f6 gray\">\n              A suprise item will be substitued\n            </div>\n            <div class=\"w-100 bb b--silver pv2 fl\">\n              {selectedExcludes.map(el =>\n                <div\n                  class=\"fl f6 ph3 ma1 ba br-pill b--streamside-orange bg-streamside-orange white pointer\"\n                  name=\"selectedExcludes\"\n                  data-item={el.shopify_product_id}\n                  data-title={el.shopify_title}\n                  title=\"Remove from your box\"\n                >\n                  {el.shopify_title} &#x2718;\n                </div>)}\n            </div>\n          </div>\n        ) : \"\"}\n      </div>\n    )\n  }\n};\n\n\nexport default AnimationWrapper(BoxProducts);\n","/** @jsx createElement */\n/**\n * The date select component used by container-box\n *\n * @module app/components/container/dateSelector\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { selectDateEvent, selectorOpenEvent } from \"../events\";\nimport SelectMenu from \"../select-menu\";\n\n/**\n * Date selector component\n *\n * @yields {Element} DOM component\n */\nfunction* DateSelector({fetchDates, selectedDate}) {\n\n  /**\n   * Display date selection menu if active\n   *\n   * @member selectDateOpen\n   * @type {boolean}\n   */\n  let selectDateOpen = false;\n  /**\n   * Selector id for select menu\n   *\n   * @member selectorId\n   * @type {string}\n   */\n  const selectorId = \"selectDate\";\n  /**\n   * Handle mouse up on selected components\n   *\n   * @function handleMouseUp\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleMouseUp = (ev) => {\n    if (ev.target.tagName === \"BUTTON\") {\n      switch(ev.target.id) {\n        case selectorId:\n          this.dispatchEvent(selectorOpenEvent(selectorId));\n          break;\n      }\n    } else if (ev.target.tagName === \"DIV\") {\n      switch(ev.target.getAttribute(\"name\")) {\n        case selectorId:\n          const date = ev.target.getAttribute(\"data-item\");\n          this.dispatchEvent(selectorOpenEvent(null));\n          this.dispatchEvent(selectDateEvent(date));\n          break;\n      }\n    }\n  };\n  this.addEventListener(\"mouseup\", handleMouseUp);\n  /**\n   * Handle selector open event, if matching selectorId the menu is open, else close\n   *\n   * @function handleSelectorOpen\n   * @param {object} ev The firing event\n   * @listens selectorOpenEvent\n   */\n  const handleSelectorOpen = (ev) => {\n    if (selectorId === ev.detail.selector) {\n      selectDateOpen = !selectDateOpen;\n    } else {\n      selectDateOpen = false;\n    }\n    this.refresh();\n  };\n  this.addEventListener(\"selectorOpenEvent\", handleSelectorOpen)\n\n  for ({fetchDates, selectedDate} of this) {\n    yield (\n      <div id=\"dateSelector\">\n        { (fetchDates.length > 0) ? (\n          <Fragment>\n            { !selectedDate && (\n              <div class=\"warn fg-warn br2 w-100 ba mb2 tc\">\n                <span class=\"f3 b pr1\">&#33;</span>\n                Please choose a date for delivery\n              </div>\n            )}\n\n            <div class=\"relative\">\n              <SelectMenu\n                id={selectorId}\n                menu={fetchDates.map(el => ({text: el, item: el}))}\n                title=\"Select Date\"\n                active={selectDateOpen}\n              >\n                { selectedDate ? selectedDate : \"Select delivery date\" }&nbsp;&nbsp;&nbsp;&#9662;\n              </SelectMenu>\n            </div>\n          </Fragment>\n        ) : (\n          <div class=\"warn fg-warn br2 w-100 ba pa1 mb2 tc\">\n            <span class=\"f3 b pr1\">&#33;</span>\n            No boxes scheduled for delivery, please come back later.\n          </div>\n        )}\n      </div>\n    )\n  }\n};\n\nexport default DateSelector;\n","/** @jsx createElement */\n/**\n * The box produst component used by container-box\n * Exported wrapped in animation wrapper\n *\n * @module app/components/container/dateSelector\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\n\nimport AnimationWrapper from \"../animation-wrapper\";\nimport getPrice from \"../price\";\nimport { moveProductEvent } from \"../events\";\nimport { selectorOpenEvent } from \"../events\";\nimport SelectMenu from \"../select-menu\";\n\n/**\n * Box products display, shows included as well as excluded items and addons\n *\n * @yields {Element} DOM component\n */\nfunction* ProductSelector({selectedIncludes, possibleAddons}) {\n\n  /**\n   * Display remove item selection menu if active\n   *\n   * @member removeItemOpen\n   * @type {boolean}\n   */\n  let removeItemOpen = false;\n  /**\n   * Display add item selection menu if active\n   *\n   * @member addItemOpen\n   * @type {boolean}\n   */\n  let addItemOpen = false;\n  /**\n   * Selector id for add item select menu\n   *\n   * @member addItemId\n   * @type {string}\n   */\n  const addItemId = \"addItem\";\n  /**\n   * Selector id for remove item select menu\n   *\n   * @member removeItemId\n   * @type {string}\n   */\n  const removeItemId = \"removeItem\";\n  /**\n   * Handle mouse up on selected components\n   *\n   * @function handleMouseUp\n   * @param {object} ev The firing event\n   * @listens click\n   */\n  const handleMouseUp = (ev) => {\n    let id;\n    if (ev.target.tagName === \"BUTTON\") {\n      switch(ev.target.id) {\n        case addItemId:\n          this.dispatchEvent(selectorOpenEvent(addItemId));\n          break;\n        case removeItemId:\n          this.dispatchEvent(selectorOpenEvent(removeItemId));\n          break;\n      }\n    } else if (ev.target.tagName === \"DIV\") {\n      switch(ev.target.getAttribute(\"name\")) {\n        case addItemId:\n          this.dispatchEvent(selectorOpenEvent(null));\n          id = ev.target.getAttribute(\"data-item\");\n          this.dispatchEvent(moveProductEvent(id, \"possibleAddons\", \"selectedAddons\"));\n          break;\n        case removeItemId:\n          this.dispatchEvent(selectorOpenEvent(null));\n          id = ev.target.getAttribute(\"data-item\");\n          this.dispatchEvent(moveProductEvent(id, \"selectedIncludes\", \"selectedExcludes\"));\n          break;\n        case \"possibleAddons\":\n          id = ev.target.getAttribute(\"data-item\");\n          this.dispatchEvent(moveProductEvent(id, \"possibleAddons\", \"selectedAddons\"));\n          break;\n      }\n    }\n  };\n  this.addEventListener(\"mouseup\", handleMouseUp);\n  /**\n   * Handle selector open event, if matching selectorId the menu is open, else close\n   *\n   * @function handleSelectorOpen\n   * @param {object} ev The firing event\n   * @listens selectorOpenEvent\n   */\n  const handleSelectorOpen = (ev) => {\n    if (addItemId === ev.detail.selector) {\n      addItemOpen = !addItemOpen;\n      removeItemOpen = false;\n    } else if (removeItemId === ev.detail.selector) {\n      removeItemOpen = !removeItemOpen;\n      addItemOpen = false;\n    } else {\n      addItemOpen = false;\n      removeItemOpen = false;\n    }\n    this.refresh();\n  };\n  this.addEventListener(\"selectorOpenEvent\", handleSelectorOpen)\n\n  for ({selectedIncludes, possibleAddons} of this) {\n    yield (\n      <div id=\"productSelector\" class=\"absolute o-0\">\n        <div>\n\n          { (selectedIncludes.length > 0) && (\n            <SelectMenu\n              id={removeItemId}\n              menu={selectedIncludes.map(el => ({text: el.shopify_title, item: el.shopify_product_id}))}\n              title=\"Remove items from your box\"\n              active={removeItemOpen}\n            >\n              Select items you'd prefer not to receive&nbsp;&nbsp;&nbsp;&#9662;\n            </SelectMenu>\n          )}\n\n          { (possibleAddons.length > 0) && (\n            <SelectMenu\n              id={addItemId}\n              menu={possibleAddons.map(el => ({text: el.shopify_title, item: el.shopify_product_id}))}\n              title=\"Add items to your box\"\n              active={addItemOpen}\n            >\n              Select items you'd like to add to the box&nbsp;&nbsp;&nbsp;&#9662;\n            </SelectMenu>\n          )}\n\n        </div>\n\n        <div class=\"ttu b pt2\">Available Products</div>\n        <div class=\"bb b--silver pv2 fl\">\n          {possibleAddons.map(el =>\n            <div\n              class=\"pointer fl f6 ph3 ma1 ba br-pill b--streamside-maroon bg-streamside-maroon white\"\n              data-item={el.shopify_product_id}\n              data-title={el.shopify_title}\n              name=\"possibleAddons\"\n              title=\"Add into your box\"\n            >\n                {el.shopify_title} {getPrice(el)}\n            </div>)}\n        </div>\n      </div>\n    )\n  }\n};\n\nexport default AnimationWrapper(ProductSelector);\n\n","/** @jsx createElement */\n/**\n * Form for editing quantities\n *\n * @module app/quantity-form\n * @exports {Element} QuantityForm\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { moveProductEvent, quantityUpdateEvent } from \"../events\";\nimport getPrice from \"../price\";\n\n/**\n * Component to update quantities in box\n *\n * @returns {Element} DOM component\n */\nfunction QuantityForm({ selectedIncludes, selectedAddons }) {\n\n  const titleStyle = \"pa2 ba outline-0 w-70 input-reset br2 bt bb bl br-0 br--left\";\n  const quantityStyle = \"pa2 ba w-10 input-reset br2 ba br--left br--right\";\n  const priceStyle = \"pa2 ba outline-0 w-20 input-reset br2 bt bb br bl-0 br--right\";\n  const toPrice = (num) => `$${(num * 0.01).toFixed(2)}`;\n\n  const TitleInput = ({ el }) => (\n    <input\n      class={titleStyle}\n      type=\"text\"\n      readonly\n      name=\"title\"\n      value={`${el.shopify_title} (${toPrice(el.shopify_price)})`}\n    />\n  );\n\n  const QuantityInput = ({ el, id }) => (\n    <input\n      class={quantityStyle}\n      type=\"number\"\n      steps=\"1\"\n      min=\"0\"\n      name=\"quantity\"\n      data-id={id}\n      id={el.shopify_product_id}\n      value={el.quantity}\n      autocomplete=\"off\"\n    />\n  );\n\n  const PriceInput = ({ el, includes }) => (\n    <input\n      class={priceStyle}\n      type=\"text\"\n      readonly\n      name=\"title\"\n      value={getPrice(el, includes)}\n    />\n  );\n\n  /** \n   * Map strings to the lists\n   *\n   * @function listMap\n   */\n  const listMap = (str) => {\n    let list;\n    switch(str) {\n      case 'selectedAddons':\n        list = selectedAddons;\n        break;\n      case 'selectedIncludes':\n        list = selectedIncludes;\n        break;\n    }\n    return list;\n  }\n  /**\n   * Handle change on selected input elements\n   *\n   * @function handleChange\n   * @param {object} ev The firing event\n   * @listens change\n   */\n  const handleChange = (ev) => {\n    if (ev.target.tagName === \"INPUT\") {\n      if (ev.target.name === \"quantity\") {\n        this.dispatchEvent(quantityUpdateEvent(ev.target.id, ev.target.value, ev.target.getAttribute(\"data-id\")));\n      }\n    }\n  };\n  this.addEventListener(\"change\", handleChange);\n\n  return (\n    <div class=\"relative\">\n      <div class=\"absolute w-100 ba bg-near-white z-9999\">\n        <button\n          class=\"bn outline-0 bg-transparent pa0 no-underline mid-gray dim o-70 absolute top-0 right-1\"\n          name=\"close\"\n          type=\"button\"\n          id=\"qtyFormClose\"\n          title=\"Close modal\"\n        >\n          &#x2716;\n          <span class=\"dn\">Close modal</span>\n        </button>\n        <div class=\"pa2 bg-white\">\n          <p class=\"fw2 ttu tracked mt2 mb1 f7 tc\">Included:</p>\n          {selectedIncludes.map(el => \n            <div class=\"mv1 center\">\n              <TitleInput el={el} />\n              <QuantityInput el={el} id=\"selectedIncludes\" />\n              <PriceInput el={el} includes={true} />\n            </div>\n          )}\n          {(selectedAddons.length > 0) && (\n            <Fragment>\n              <p class=\"fw2 ttu tracked mt2 mb1 f7 tc\">Extras:</p>\n              {selectedAddons.map(el => \n                <div class=\"mv1 center\">\n                  <TitleInput el={el} />\n                  <QuantityInput el={el} id=\"selectedAddons\" />\n                  <PriceInput el={el} includes={false} />\n                </div>\n              )}\n            </Fragment>\n          )}\n          <div class=\"tr\">\n            <button\n              class=\"f6 pv1 ph2 ma1 outline-0 bg-light-gray dark-gray b--gray ba br2 pointer\"\n              name=\"close\"\n              type=\"button\"\n              id=\"qtyFormClose\"\n              title=\"Close modal\"\n              >\n                Close\n              </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n};\n\nexport default QuantityForm;\n","/** @jsx createElement */\n/**\n * Error display component module\n *\n * @module app/lib/error\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, isElement } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Error component\n *\n * @returns {Element} DOM component\n * @param {object} props  Component properties\n * @param {Element|string|object} props.msg Error to be displayed\n * @example\n * { error && <ErrorMsg msg=\"Some error message\" /> }\n */\nconst ErrorMsg = ({ msg }) => {\n  // console.log(msg, typeof msg, isElement(msg));\n  if (typeof msg === \"string\" || isElement(msg)) {\n    return (\n      <div class=\"dark-red mv2 pt2 pl2 br3 ba b--dark-red bg-washed-red\">\n        <p class=\"tc\">{msg}</p>\n      </div>\n    );\n  }\n\n  if (typeof msg === \"object\" || !msg.msg) {\n    return (\n      <div class=\"dark-red mv2 pt2 pl2 br3 ba b--dark-red bg-washed-red\">\n        <p class=\"tc\">{msg.toString()}</p>\n      </div>\n    );\n  }\n\n  return (\n    <div class=\"dark-red mv2 pt2 pl2 br3 ba b--dark-red bg-washed-red\">\n      <p class=\"tc\">\n        {msg.msg}:{msg.err}\n      </p>\n    </div>\n  );\n};\n\nexport default ErrorMsg;\n\n","\n/**\n * Event dispatched by Product selectors in ProductSelector\n * Listened for by ContainerBox and moves products between lists\n *\n * @function moveProductEvent\n * @param {string} product The id\n * @param {string} from Identify the from list\n * @param {string} to Identify the target list\n */\nexport const moveProductEvent = (id, from, to) =>\n  new CustomEvent(\"moveProductEvent\", {\n    bubbles: true,\n    detail: { id, from, to },\n  });\n\n/**\n * Event dispatched by DateSelector and listened for by ContainerBox\n * @function selectDateEvent\n * @param {string} date The date string selected,\n */\nexport const selectDateEvent = (date) =>\n  new CustomEvent(\"selectDateEvent\", {\n    bubbles: true,\n    detail: { date },\n  });\n\n/**\n * Event dispatched by all selectors so that the others can be closed if open\n * @function selectorOpen\n * @param {string} selector The string indentifier that is open, the rest will close\n */\nexport const selectorOpenEvent = (selector) =>\n  new CustomEvent(\"selectorOpenEvent\", {\n    bubbles: true,\n    detail: { selector },\n  });\n\n/**\n * Event dispatched by quantity form when quantity updated\n * @function quantityUpdateEvent\n * @param {string} product The id\n * @param {string} from Identify the from list\n * @param {string} to Identify the target list\n */\nexport const quantityUpdateEvent = (id, quantity, list) =>\n  new CustomEvent(\"quantityUpdateEvent\", {\n    bubbles: true,\n    detail: { id, quantity, list },\n  });\n","/**\n * Fetch components\n *\n * @module app/lib/fetch\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\n\n/**\n * Fetch component that attempts to deal reasonably if the fetch fails. Always\n * uses a `GET` request` and expects a `json` response.\n *\n * @returns {Promise} A promise resolving to { error, json }\n * @param {string} src Url to send request\n * @example\n * const src\n * Fetch(src)\n *   .then((result) => {\n *     const { error, json } = result;\n *   })\n */\nconst Fetch = async (src) => {\n  //console.log('fetching', src);\n  return fetch(src)\n    .then(async (response) => {\n      if (response.status !== 200) {\n        throw new Error(JSON.stringify(await response.json()));\n      }\n      return response.json();\n    })\n    .then((json) => {\n      //console.log(\"Got this in GET fetch:\", json);\n      return { error: null, json };\n    })\n    .catch((error) => {\n      console.warn(\"Got error in GET fetch:\", error);\n      if (Object.prototype.hasOwnProperty.call(error, \"err\")) {\n        return { error: error.err, json: null };\n      }\n      return { error, json: null };\n    });\n};\n\n/**\n * PostFetch component that attempts to deal reasonably if the fetch fails. Always\n * uses a `POST` request` and expects a `json` response.\n *\n * @returns {Promise} A promise resolving to { error, json }\n * @param {object} opts Dicitonary of options\n * @param {string} opts.src Url to send request to\n * @param {string} opts.data Data to be sent with request\n * @param {string} opts.headers Headers to send data with, usually `{\"Content-Type\": \"application/json\"}` but not when uploading files.\n * @example\n * const src = \"api/create-todo\";\n * const data = {title: \"Fix me\"};\n * const headers = { \"Content-Type\": \"application/json\" };\n * PostFetch({src, data, headers})\n *   .then((result) => {\n *     const { error, json } = result;\n *   })\n */\nconst PostFetch = async ({ src, data, headers }) => {\n  // use json if according to content-type\n  const formdata =\n    headers[\"Content-Type\"] === \"application/json\"\n      ? JSON.stringify(data)\n      : data;\n\n  const opts = {\n    method: \"POST\",\n    body: formdata,\n  };\n\n  // add headers if set in arguments - i.e. using none if sending files\n  if (headers) opts.headers = headers;\n\n  return fetch(src, opts)\n    .then(async (response) => {\n      if (response.status !== 200) {\n        throw new Error(JSON.stringify(await response.json()));\n      }\n      //console.log(\"Got this response in POST fetch\", response);\n      return response.json();\n    })\n    .then((json) => {\n      //console.log(\"Got this in POST fetch:\", json);\n      return { error: null, json };\n    })\n    .catch((error) => {\n      console.log(\"Got error in POST fetch:\", error);\n      if (Object.prototype.hasOwnProperty.call(error, \"err\")) {\n        return { error: error.err, json: null };\n      }\n      return { error, json: null };\n    });\n};\n\nexport { Fetch, PostFetch };\n\n","/** @jsx createElement */\n/**\n * Flash message\n *\n * @module app/flash\n * @exports {Element} Flash\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Flash\n *\n * @returns {Element} DOM component\n */\nfunction* Flash({ children }) {\n  /*\n  this.addEventListener('webkitAnimationEnd', (ev) => {\n    console.log('animation ends', ev.target);\n    ev.target.classList.add(\"o-0\");\n  });\n  */\n  for ({children} of this) {\n    yield (\n      <div \n        class=\"dn flash ba br2 z-max fixed top-2 right-2 pa3\" \n      >\n        <div class=\"tc\">\n            { children }\n        </div>\n      </div>\n    )\n  };\n};\n\nexport default Flash;\n\n/*\n<div \n  class=\"fade-out flash ba br2 z-max fixed top-2 pa3 dn\" \n>\n  <div class=\"tc\">\n      { children }\n  </div>\n</div>\n*/\n","/** @jsx createElement */\n/**\n * Cart Icon\n *\n * @module app/icon-cart\n * @exports {Element} IconCart\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\n\nconst IconCart = () => (\n<svg aria-hidden=\"true\" focusable=\"false\" role=\"presentation\" class=\"icon icon-cart\" viewBox=\"0 0 37 40\"><path d=\"M36.5 34.8L33.3 8h-5.9C26.7 3.9 23 .8 18.5.8S10.3 3.9 9.6 8H3.7L.5 34.8c-.2 1.5.4 2.4.9 3 .5.5 1.4 1.2 3.1 1.2h28c1.3 0 2.4-.4 3.1-1.3.7-.7 1-1.8.9-2.9zm-18-30c2.2 0 4.1 1.4 4.7 3.2h-9.5c.7-1.9 2.6-3.2 4.8-3.2zM4.5 35l2.8-23h2.2v3c0 1.1.9 2 2 2s2-.9 2-2v-3h10v3c0 1.1.9 2 2 2s2-.9 2-2v-3h2.2l2.8 23h-28z\"/></svg>\n);\n\nexport default IconCart;\n","\n/**\n * Make up a string price\n *\n * @param {number} num The integer number to use\n * @returns {string} Price string\n */\nconst toPrice = (num) => `$${(num * 0.01).toFixed(2)}`;\n/**\n * Figure the price for the element, if it's a standard included product only\n * extra quantities greater than one incur a price\n *\n * @param {object} el The target element\n * @param {boolean} includes Is this a standard included product?\n * @returns {string} Price string\n */\nconst getPrice = (el, includes) => toPrice(el.shopify_price * (includes ? el.quantity - 1 : el.quantity));\n\nexport default getPrice;\n","/** @jsx createElement */\n/**\n * Router and starting  point of the box app.\n * Renders [crank]{@link https://www.npmjs.com/@bikeshaving/crank} elements\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/initialize\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\n\nimport AddToCartButton from \"./add-button.js\";\nimport TextButton from \"./text-button.js\";\nimport BarLoader from \"./bar-loader.js\";\nimport ProductDescription from \"./product-description.js\";\nimport QuantityForm from \"./container/quantity-form.js\";\nimport SelectMenu from \"./select-menu\";\nimport Flash from \"./flash\";\nimport IconCart from \"./icon-cart\";\nimport { Fetch } from \"./fetch\";\nimport { shallowEqual } from \"../lib\";\n\nconst hasOwnProp = Object.prototype.hasOwnProperty;\n/**\n * BoxApp crank component\n *\n * @function BoxApp\n * @param {object} props The property object\n * @param {object} props.productJson Shopify product data as extracted from\n * product page json script tag\n * @returns {Element} A crank DOM component\n */\nfunction* ProductBoxApp({productJson}) {\n  /**\n   * If fetching data was unsuccessful.\n   *\n   * @member fetchError\n   * @type {object|string|null}\n   */\n  let fetchError = null;\n  /**\n   * If there is a cart and this is the container box\n   *\n   * @member cartJson\n   * @type {object|null}\n   */\n  let cartJson = null;\n  /**\n   * If there is a cart and these are the addon items\n   *\n   * @member cartAddons\n   * @type {array}\n   */\n  let cartAddons = null;\n  /**\n   * If there is a cart and this is the container box\n   *\n   * @member cartBox\n   * @type {object|null}\n   */\n  let cartBox = null;\n  /**\n   * Display loading indicator while fetching data\n   *\n   * @member loading\n   * @type {boolean}\n   */\n  let loading = true;\n  /**\n   * A message to the user - on 4s fade out\n   *\n   * @member flashMessage\n   * @type {string}\n   */\n  let flashMessage = \"\";\n  /**\n   * The total price TODO here in development udating on refresh - production\n   * may actuall use priceElement as above\n   *\n   * @member priceElement\n   * @type {Element}\n   */\n  let totalPrice = productJson.variants[0].price;\n\n  /**\n   * Uses fetch to collect current cart for the session \n   *\n   * @function fetchCart\n   */\n  const fetchCart = async () => {\n    const {error, json} = await Fetch(\"/cart.js\");\n    if (error) {\n      fetchError = error;\n      this.refresh();\n    } else {\n      if (!json.items) {\n        fetchError = \"Failed to load cart data\";\n        this.refresh();\n        return;\n      }\n      console.log(json);\n      cartJson = json;\n      cartBox = json.items.find(el => el.product_type === \"Container Box\");\n      cartAddons = json.items.filter(el => el.product_type === \"Box Produce\");\n      console.log(cartBox);\n      // Can we match this product to a cart item?\n      const match = json.items.find(el => {\n        return productJson.variants.find(variant => {\n          return variant.id === parseInt(el.variant_id);\n        });\n      });\n      if (typeof match === \"undefined\") {\n        // no we don't\n        console.log('no');\n      } else {\n        console.log('yes');\n        // use fetch to get container box data and disply image etc - can't do\n        // so here without providing api authentication but probably can when\n        // within the site itself, including credentials. So settle for the\n        // moment with providing title and whatever else we can glean from the\n        // cart data.\n        // so what to do now 1. show thus, 2. give the option to add to box?\n      }\n      loading = false;\n      this.refresh();\n    }\n  };\n\n  fetchCart();\n\n  while(true) {\n    yield (\n      <div class=\"mt2 sans-serif center measure\">\n        { fetchError && <Error msg={fetchError} /> }\n        { !loading ? (\n          <Fragment>\n            { flashMessage && (\n              <Flash>{ flashMessage }</Flash>\n            )}\n            { cartBox && (\n              <Fragment>\n                <IconCart />\n                <div>{cartBox.title} {cartBox.properties[\"Delivery Date\"]}</div>\n                <div>{cartJson.total_price}</div>\n                <div>\n                  {cartAddons.map(el => (\n                    <div>{el.title} {el.quantity} {el.properties[\"Delivery Date\"]}</div>\n                  ))}\n                </div>\n              </Fragment>\n            )}\n          </Fragment>\n        ) : (\n          <div>Here?</div>\n        )}\n      </div>\n    )\n  }\n}\n\nexport default ProductBoxApp;\n","/** @jsx createElement */\n/**\n * Router and starting  point of the box app.\n * Renders [crank]{@link https://www.npmjs.com/@bikeshaving/crank} elements\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/initialize\n * @requires @bikeshaving/crank\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport { renderer } from \"@bikeshaving/crank/cjs/dom\";\n\nimport AddToCartButton from \"./add-button.js\";\nimport TextButton from \"./text-button.js\";\nimport BarLoader from \"./bar-loader.js\";\nimport ProductDescription from \"./product-description.js\";\nimport QuantityForm from \"./container/quantity-form.js\";\nimport SelectMenu from \"./select-menu\";\nimport Flash from \"./flash\";\nimport IconCart from \"./icon-cart\";\nimport { Fetch } from \"./fetch\";\nimport { shallowEqual } from \"../lib\";\n\nconst hasOwnProp = Object.prototype.hasOwnProperty;\n/**\n * BoxApp crank component\n *\n * @generator\n * @param {object} props The property object\n * @param {object} props.productJson Shopify product data as extracted from\n * product page json script tag\n * @yields {Element} A crank DOM component\n */\nasync function* ProductBoxApp({productJson}) {\n  /**\n   * If fetching data was unsuccessful.\n   *\n   * @member fetchError\n   * @type {object|string|null}\n   */\n  let fetchError = null;\n  /**\n   * Contains box data as collected from api/current-boxes-for-box-product,\n   * these are the boxes of which this product is either an included product or\n   * possible add on.\n   *\n   * @member fetchJson\n   * @type {object}\n   */\n  let fetchJson = {};\n  /**\n   * The box ids: Object.keys(fetchJson)\n   *\n   * @member fetchDates\n   * @type {object}\n   */\n  let fetchBoxes = [];\n  /**\n   * Contains cart data collected from html template json data\n   * This will then also contain a selected date\n   *\n   * @member cartJson\n   * @type {object}\n   */\n  const cartJson = await JSON.parse(\n    document.querySelector(\"#cart-json\").textContent\n  );\n  /**\n   * If there is a cart and this is the container box\n   *\n   * @member cartBox\n   * @type {object|null}\n   */\n  let cartBox = null;\n  /**\n  * This current product is included in the cart container box\n   *\n   * @member productInCart\n   * @type {boolean}\n   */\n  let inCart = false;\n  /**\n   * Display loading indicator while fetching data\n   *\n   * @member loading\n   * @type {boolean}\n   */\n  let loading = true;\n  /**\n   * Base url to api\n   *\n   * @member baseUrl\n   * @type {string}\n   */\n  const baseUrl = \"https://streamsidedev.cousinsd.net/api/\";\n  /**\n   * The cart price??\n   *\n   * @member priceElement\n   * @type {Element}\n   */\n  let totalPrice = productJson.variants[0].price;\n  /**\n   * Gather box includes for display, watch for dates, cart items and date\n   * already selected from collection\n   *\n   * @function init\n   */\n  const init = async () => {\n    console.log(productJson.id);\n    await Fetch(\n      `${baseUrl}current-boxes-for-box-product/${productJson.id}`\n    ).then(async ({ error, json }) => {\n      if (error) {\n        fetchError = error;\n      } else {\n        if (Object.keys(json).length > 0) {\n          fetchBoxes = Object.keys(json);\n          fetchJson = json;\n          const addOn = [];\n          const included = [];\n          Object.entries(fetchJson).forEach(([id, byDeliveryDate]) => {\n            byDeliveryDate.forEach(box => {\n              console.log(box);\n              if (box.addOnProduct) {\n              }\n              if (box.includedProduct) {\n              }\n            });\n          });\n        }\n      }\n      // in both the following circumstances we should present entire edit box\n      if (cartJson.items) {\n        // find the selected date from the items\n        for (const item of cartJson.items) {\n          if (item.product_type === \"Container Box\") {\n            // get the delivery date regardless of which box\n            cartBox = item;\n            cartBox.deliveryDate = item.properties[\"Delivery Date\"];\n            // group by applicable type\n          }\n          if (item.product_type === \"Box Produce\") {\n            // these are included in the box as addons\n            if (item.product_id === productJson.id) {\n              // this product is in the cart\n              inCart = true;\n            }\n          }\n        }\n      }\n\n      loading = false;\n      this.refresh();\n    });\n  };\n\n  await init();  // set up script\n\n  for await ({ productJson } of this) {\n    yield (\n      <div class=\"mt2 sans-serif center measure\">\n        { fetchError && <Error msg={fetchError} /> }\n        { !loading ? (\n          <Fragment>\n            { cartBox && (\n              <Fragment>\n                <IconCart />\n                <a href={cartBox.url}><img width=\"100\" src={cartBox.image} alt={cartBox.product_title} /></a>\n                <div>{cartBox.title} {cartBox.deliveryDate}</div>\n                <div>{cartJson.total_price}</div>\n                { fetchBoxes.map(el => (\n                  <Fragment>\n                    { fetchJson[el].map(box => (\n                      <div>{box.shopify_title} {box.delivered}\n                        <span>&nbsp;\n                        { box.addOnProduct && \"Add on product\" }\n                        { box.includedProduct && \"Included product\" }\n                        </span>\n                      </div>\n                    ))}\n                  </Fragment>\n                ))}\n              </Fragment>\n            )}\n            { !cartBox && (\n              <Fragment>\n                { Object.entries(fetchJson).map(([id, byDeliveryDate]) => (\n                  <Fragment>\n                    { byDeliveryDate.map(box => (\n                      <div>{box.shopify_title} {box.delivered}\n                        <span>&nbsp;\n                        { box.addOnProduct && \"Add on product\" }\n                        { box.includedProduct && \"Included product\" }\n                        </span>\n                      </div>\n                    ))}\n                  </Fragment>\n                ))}\n              </Fragment>\n            )}\n          </Fragment>\n        ) : (\n          <BarLoader />\n        )}\n      </div>\n    )\n  }\n}\n\nexport default ProductBoxApp;\n","/** @jsx createElement */\n/**\n * The product description and image, this is a temporary component while\n * developing\n *\n * @module app/product-description\n * @exports {Element} ProductDescription\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Product description component - for development only\n *\n * @returns {Element} DOM component\n */\nconst ProductDescription = ({ product, price }) => {\n  return (\n    <Fragment>\n      <h3 class=\"center\">{product.title}</h3>\n      <div class=\"w-100 vh-25 overflow-hidden\">\n      <img\n        src={`https:${product.featured_image}`}\n        title={product.title}\n        class=\"br2\"\n      />\n        </div>\n      <div class=\"pa2 dt w-100 mb1\">\n        <div class=\"dtc w-third b black\">\n          <span class=\"black price-item price-item--regular\" data-regular-price>\n            ${(price * 0.01).toFixed(2)}\n          </span>\n        </div>\n        <div class=\"dtc fw3\">\n          {product.title}\n        </div>\n        <div class=\"dtc tr\">\n          {product.id}\n        </div>\n      </div>\n    </Fragment>\n  )\n};\n\nexport default ProductDescription;\n\n\n","/** @jsx createElement */\n/**\n * Component\n *\n * @module app/product-description\n * @exports {Element} SelectDeliveryDate\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement, Fragment } from \"@bikeshaving/crank/cjs\";\nimport TextButton from \"./text-button.js\";\n\n/**\n * Component\n *\n * @returns {Element} DOM component\n * <SelectMenu id=\"selectDate\" menu={fetchDates} title=\"Select Date\" active={menuSelectDate} />\n */\nconst SelectMenu = ({ id, active, title, menu, children }) => {\n  const type = (id.startsWith(\"selectDate\")) ? \"ttu tracked\" : \"\";\n  return (\n    <Fragment>\n      <button\n        class={`dib w-100 f6 ${type} outline-0 gray b--gray ba ba1 bg-transparent br2 pa2 mb1 pointer`}\n        title={title}\n        id={id}\n        type=\"button\"\n        >\n        { children }\n      </button>\n      { active && (\n        <div class=\"absolute w-100 bg-white br2 z-max\">\n        {menu.map((el, idx, arr) => (\n          <TextButton text={el.text} index={idx} array={arr} name={id} item={el.item} />\n        ))}\n        </div>\n      )}\n    </Fragment>\n  )\n};\n\nexport default SelectMenu;\n","/** @jsx createElement */\n/**\n *\n * @module app/form/filter-select\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Renders a select field for generating filters\n *\n * @generator\n * @param {object} props The property object\n * @param {string} props.text The display text - will be slugified to create name/id\n * @param {number} props.index The index of the menu array - used to add borders and border radius to group multiple items\n * @param {array} props.array The menu array that this is a part of\n * @param {string} props.title Text used for visual hint on hover\n * @param {string} props.name Used to identify the action when listening for click on the component\n * @param {string|number} props.item Added to `data-item` attribute and is the object collected and used in final action\n * @yields {Element} A select field\n */\nfunction TextButton({ text, index, array, title, name, item }) {\n  /**\n   * Style selection according to props.position to add rounded corners as\n   * necessary to render grouped elements\n   *\n   * @member {string}\n   */\n  let position;\n  switch(index) {\n    case 0:\n      position = \"top\";\n      break;\n    case (array.length - 1):\n      position = \"bottom\";\n      break;\n    default:\n      position = \"center\";\n  }\n  if (array.length === 1) position = \"single\";\n  let borders = \"ba\";\n  if (position === \"top\") borders = \"br bl bt bb-0 br2 br--top\";\n  if (position === \"center\") borders = \"bl br bb-0 bt-0 br--top br2 br--top br--bottom\";\n  if (position === \"bottom\") borders = \"br bl bb bt-0 br2 br--bottom\";\n  if (position === \"single\") borders = \"ba br2\";\n\n  const slug = text.replace(/ /g, '-');\n  const type = (name === \"selectDate\") ? \"ttu tracked\" : \"\";\n\n  return (\n    <button\n      class={`w-100 f6 ${type} outline-0 dark-gray b--gray ${borders} bg-transparent pointer pa0`}\n      title={text}\n      name={slug}\n      id={slug}\n      type=\"button\"\n      >\n        <div\n          name={name}\n          class=\"dim bg-animate hover-bg-near-white pa1\"\n          data-item={item}\n          data-title={text}\n        >\n          { text }\n        </div>\n      </button>\n  );\n}\n\nexport default TextButton;\n\n","/* eslint-disable */\n/**\n * Provide some helper methods\n *\n * @module app/helpers\n */\n\n/**\n * Sort an object by it's keys.\n *\n * @function sortObjectByKeys\n * @param {object} o An object\n * @returns {object} The sorted object\n * @example\n * sortObjectByKeys({'c': 0, 'a': 2, 'b': 1});\n * // returns {'a': 2, 'b': 1, 'c': 0}\n */\nexport const sortObjectByKeys = (o) => {\n  return Object.keys(o)\n    .sort()\n    .reduce((r, k) => ((r[k] = o[k]), r), {});\n};\n\n/**\n * Sort an array of objects by key.\n *\n * @function sortObjectByKey\n * @param {object} o An object\n * @param {string} key The attribute to sort\n * @returns {object} The sorted object\n * @example\n * sortObjectByKey([{'s1': 5, 's2': 'e'}, {'s1': 2, 's2': 'b'}], 's1');\n * // returns [{'s1': 2, 's2': 'b'}, {'s1': 5, 's2': 'e'}]\n * sortObjectByKey([{'s1': 5, 's2': 'e'}, {'s1': 2, 's2': 'b'}], 's2');\n * // returns [{'s1': 2, 's2': 'b'}, {'s1': 5, 's2': 'e'}]\n */\nexport const sortObjectByKey = (o, key) => {\n  o.sort((a, b) => {\n    let nameA = a[key];\n    let nameB = b[key];\n    if (!Number.isInteger) {\n      nameA = a[key].toUpperCase(); // ignore upper and lowercase\n      nameB = b[key].toUpperCase(); // ignore upper and lowercase\n    }\n    if (nameA < nameB) return -1;\n    if (nameA > nameB) return 1;\n    return 0;\n  });\n  return o;\n};\n\n/**\n * Get the next upcoming date for a particular weekday\n *\n * @function findNextWeekday\n * @param {number} day Integer day of week, Monday -> 0\n * @returns {object} Date object\n */\nconst findNextWeekday = (day) => {\n  // return the date of next Thursday as 14/01/2021 for example\n  // Thursday day is 4, Saturday is 6\n  const now = new Date();\n  now.setDate(now.getDate() + ((day + (7 - now.getDay())) % 7));\n  return now;\n};\n","/**\n * Handle page transitions for site\n *\n * @author Darryl Cousins <darryljcousins@gmail.com>\n * @module app/standalone/transitions\n * @listens DOMContentLoaded\n */\nimport \"regenerator-runtime/runtime\"; // regeneratorRuntime error\nimport Swup from \"swup\";\nimport SwupScrollPlugin from '@swup/scroll-plugin';\nimport SwupProgressPlugin from '@swup/progress-plugin';\nimport collection from \"./collection\";\nimport boxApp from \"./box-app\";\n\nconst init = () => {\n\n  const page_type = document.querySelector(\"#swup\").getAttribute(\"data-page-type\");\n\n  switch (page_type) {\n    case \"index\":\n      collection.init();\n      break;\n    case \"collection\":\n      collection.init();\n      break;\n    case \"product\":\n      boxApp.init();\n      break;\n    case \"page\":\n      break;\n  };\n\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n  // do your setup here\n  //const main = document.querySelectorAll(\"#swup\");\n  //console.log('page loaded in transitions, HERE');\n  const swup = new Swup({\n    cache: false,\n    plugins: [\n      new SwupScrollPlugin({}),\n      new SwupProgressPlugin({}),\n    ],\n    containers: [\n      \"#swup\",\n      \"#cartIcon\"\n    ]\n  });\n  window.swup = swup;\n  init();\n  swup.on('contentReplaced', init);\n  //swup.on('willReplaceContent', () => window.observer.disconnect());\n});\n\n","/**\n * Some library methods\n *\n * @module app/lib\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\n\n/**\n * Shallow compare two objects - adequate from 'flat' objects of key/value pairs\n *\n * @returns {boolean} Returns true if shallow comparison passes\n * @param {object} object1 Object to compare\n * @param {object} object2 Other object to compare\n * @example\n * const o1 = {me: 'dc', you: 'mh'};\n * const o2 = {me: 'dc', you: 'mh'};\n * shallowEqual(o1, o2) // true\n */\nfunction shallowEqual(object1, object2) {\n  const keys1 = Object.keys(object1);\n  const keys2 = Object.keys(object2);\n\n  if (keys1.length !== keys2.length) {\n    return false;\n  }\n\n  for (let key of keys1) {\n    if (object1[key] !== object2[key]) {\n      return false;\n    }\n  }\n\n  return true;\n}\n\nexport {\n  shallowEqual\n};\n","/** @jsx createElement */\n/**\n * Component\n *\n * @module app/product-description\n * @exports {Element} Template\n * @author Darryl Cousins <darryljcousins@gmail.com>\n */\nimport { createElement } from \"@bikeshaving/crank/cjs\";\n\n/**\n * Component\n *\n * @returns {Element} DOM component\n */\nconst Template = () => {\n  return <div>Template</div>;\n};\n\nexport default Template;\n\n\n\n"]}